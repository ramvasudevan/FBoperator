\documentclass[final,leqno]{siamart}
\usepackage{amsmath,amssymb}
%\usepackage{geometry} % see geometry.pdf on how to lay out the page. There's lots.
%\geometry{a4paper} % or letter or a5paper or ... etc
% \geometry{landscape} % rotated page geometry

%  POSSIBLY USEFULE PACKAGES
\usepackage{graphicx}
\usepackage{caption,subcaption}
\usepackage{tensor}
%\usepackage[boxed]{algorithm2e}
\usepackage{algorithmic}
\usepackage{todonotes}

%  NEW COMMANDS
\newcommand{\ram}[1]{{\normalsize{\textbf{({\color{red}RAMBO:\ }#1)}}}}
\newcommand{\hoj}[1]{{\normalsize{\textbf{({\color{blue}HOJ:\ }#1)}}}}
\newcommand{\pder}[2]{\ensuremath{\frac{ \partial #1}{\partial #2}}}
\newcommand{\ppder}[3]{\ensuremath{\frac{\partial^2 #1}{\partial{align}
      #2 \partial #3} } }
\newcommand{\R}{\ensuremath{\mathbb{R}}}

%  NEW THEOREM ENVIRONMENTS
\newtheorem{example}[theorem]{Example}
\newtheorem{ass}[theorem]{Assumption}

% NEW ENVIRONMENTS

%  MATH OPERATORS
\DeclareMathOperator{\Diff}{Diff}
\DeclareMathOperator{\Dens}{Dens}
\DeclareMathOperator{\U}{U}
\DeclareMathOperator{\OdeSolve}{OdeSolve}
\DeclareMathOperator{\Tr}{Tr}

%  TITLE, AUTHOR, DATE
\title{Qualitatively accurate spectral schemes for advection and transport\thanks{This research was supported by the University of Michigan, Ann Arbor.}}
\author{
    Henry O. Jacobs\thanks{Department of Mechanical Engineering, University of Michigan, Ann Arbor, MI 48104, USA (\email{hojacobs@umich.edu})}
    \and
    Ram Vasudevan\thanks{Department of Mechanical Engineering, University of Michigan, Ann Arbor, MI 48104, USA (\email{ramv@umich.edu}) }
}
\date{\today}


\begin{document}

\maketitle

\begin{abstract}
	The transport and continuum equations exhibit a number of conservation laws.
	For example, scalar multiplication is conserved by the transport equation, while
	positivity of probabilities is conserved by the continuum equation.
	Certain discretization techniques, such as particle based methods, conserve these properties, but converge slower than spectral discretization methods on smooth data.
	Standard spectral discretization methods, on the other hand, do not conserve the invariants of the transport equation and the continuum equation.
	This article constructs a novel spectral discretization technique that conserves these important invariants while simultaneously preserving spectral convergence rates. 
	The performance of this proposed method is illustrated on several numerical experiments. 
\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
\label{sec:intro}

A topological space is, by the traditional definition, a set of points glued together by a topology.
Starting from these notions, one builds the space of continous functions, then the differentiable functions, and so on.
In summary, points first, then functions.
The commutative version of the Gelfand-Naimark theorem turns the ``points-first'' perspective on its head.
Specifically, the commutative Gelfand-Naimark theorem states that from any commutative $C^*$-algebra, $\mathcal{A}$, one could derive a topological space, $X$, for which $\mathcal{A} \cong C^0(X)$.
In other words, $C^0(X)$ first.
In this ``functions-first'' perspective, $C^1(X)$ is the subspace for which the derivations are bounded, and points are algebra preserving maps in the dual space (these coincide with the Dirac-delta functionals).
In summary, functions first, then points.

While this functions-first perspective has flourished within the world of pure mathematics and mathematical physics, it has not penetrated very far into the world of applied mathematics and numerical methods.
It is the thesis of this paper, that certain problems in numerical mathematics stand to benefit from this eccentric perspective.
In particularly, the class of spectral schemes for advection and transport type equations can be greatly improved by fully embracing the spirit of spectral discretization, viewing functions as foundational, and the domain as incidental.

Let $M$ be a manifold and let $X$ be a $C^2$ vector-field on $M$. 
This paper is concerned with the following pair of partial differential equations (PDEs) given in local coordinates by:
\begin{align}
	\partial_{t} f + \sum_{i=1}^n X^{i} \partial_{i} f = 0 \label{eq:function pde} \\
	\partial_{t} \rho + \sum_{i=1}^n \partial_{i} (\rho X^{i}) = 0 \label{eq:density pde}
\end{align}
for time dependent functions $f(t,\cdot) \in C^0(M)$ and a time dependent density $\rho(t,\cdot) \in L^1(M)$.
Equation \eqref{eq:function pde}, which is sometimes called the ``transport equation,'' describes how a scalar quantity is transported by the flow of $X$~\cite{Truesdell1991}.
Equation \eqref{eq:density pde}, which is sometimes called the ``continuum equation'' or ``Liouville's equation'' describes how a density (e.g. a probability distribution) is transported by the flow of $X$.
Such PDEs arise in a variety of contexts, ranging from  mechanics~\cite{Truesdell1991} to control theory~\cite{HenrionKorda2014}.

The solution to \eqref{eq:function pde} takes the form $f(x;t) = f( (\Phi_{X}^{t})^{-1}(x) ; 0) \equiv (\Phi_{X}^{t})_{*} f(\cdot;0)$
where $\Phi_{X}^{t}:M \to M$ is the flow map of $X$ at time $t$ ~\cite[Chapter 18]{Lee2006}.
This solution implies that \eqref{eq:function pde} exhibits a variety of conservation laws.
For example, if $f$ and $g$ are solutions to \eqref{eq:function pde},
then $f \cdot g$ and $f+g$ are also solutions.
Similarly, the solution to \eqref{eq:density pde} takes the form $\rho(x;t) = \det( D(\Phi_{X}^{t})^{-1}(x) ) \rho( (\Phi_{X}^{t})^{-1}(x) ;0) := (\Phi_{X}^{t})_{*} \rho(\cdot;0)$.
One can deduce that the $L^{1}$-norm of $\rho(x;t)$ is conserved in time~\cite[Theorem 16.42]{Lee2006}.
Finally, \eqref{eq:density pde} is the adjoint evolution equation to \eqref{eq:function pde} in the sense that the integral $\langle f , \rho \rangle := \int f \rho$ is constant in time. To see this compute
$\frac{d}{dt} \langle f , \rho \rangle = \int ( \partial_{t} f ) \rho + f ( \partial_{t} \rho) $.  One finds that the final integral vanishes upon substitution of \eqref{eq:function pde} and \eqref{eq:density pde} and applying integration by parts.
This conservation law motivates the following definition of qualitative accuracy:

\begin{definition} \label{def:quality}
	    A numerical method for \eqref{eq:function pde} and \eqref{eq:density pde} is \emph{qualitatively accurate} if it conserves discrete analogs of scalar multiplication/addition, the $L^{1}$-norm and the total mass for densities and the sup-norm for functions.
\end{definition}

\subsection{Our primary goal and motivation}
Now that we have defined qualitative accuracy for \eqref{eq:function pde} and \eqref{eq:density pde}, let us motivate the pursuit qualitative accuracy.
Naively, conservation laws for \eqref{eq:function pde} and \eqref{eq:density pde} are useful in numerics because they reduce the space of feasible solutions.
However, more can be said in this case.
Consider the following corollary to the Gelfand Naimark theorems~\cite{GelfandNaimark1943}.

%In particular, the only linear evolution PDEs that preserves the algebra of $C(M)$ are of the form \eqref{eq:function pde}.
%As a corollary, the only linear evolution PDEs on densities which preserves duality with functions are of the form \eqref{eq:density pde}.
%Therefore, qualitatively accurate schemes leverage the defining aspects of the \eqref{eq:function pde} and \eqref{eq:density pde} to produce numerical approximations with the same qualitative characteristics.

\begin{proposition}[follows from Corollary 1.7 of ~\cite{Bondia2001}]
	Let $M$ be a manifold.
	If $T: C(M) \to C(M)$ is a bounded automorphism preserving products/sums/complex conjugation
	then there is a unique homeomorphism $\Phi_{T}:M \to M$ such that $T[a](x) = a( \Phi_{T}(x) )$.
	That is, $\Diff(M) \equiv \operatorname{Aut}( C^{0}(M) )$ as a topological groups.
	Moreover, a linear evolution equation on $C^{0}(M)$ given by $\partial_{t} f + D[f] = 0$ for some differential operator, $D$,
	preserves  the algebra of $C(M)$ if and only if $D[f] = X^{i} \pder{f}{x^{i}}$ for some vector-field $X$.
	The dual operator is then necessarily of the form $D^{*}[\rho] = \pder{}{x^{i}}( \rho X^{i})$.
\end{proposition}

In summary, \eqref{eq:function pde} and \eqref{eq:density pde} are the generators of all algebra-preserving automorphisms of $C(M)$.
Thus, conservation of sums, products, and norms is more than just a random collection of properties exhibited by \eqref{eq:function pde} and \eqref{eq:density pde}.
\emph{Conservation of sums, products, and norms is what defines \eqref{eq:function pde} and \eqref{eq:density pde}.}
As a result, it is natural for this to be reflected in a discretization.

A good example of a qualitatively accurate numerical scheme is a particle based method.
For a continuous initial condition, $f_0$, for example, the method of characteristics ~\cite{Evans2010} describes a solution to \eqref{eq:function pde} as a time-dependent function $f( x_{t} ;t) = f_{0}( x_{0} )$ where $x_{t}$ is the solution to $\dot{x} = X(x)$.
This suggests using a particle method to solve for $f$ at a discrete set of points~\cite{Leveque1992}.
In fact, a particle method would inherit many discrete analogs of the conservation laws of \eqref{eq:function pde}, and would therefore be \emph{qualitatively accurate}.
For example, given the input $h_{0} = f_{0} \cdot g_{0}$, the output of a particle method is identical to the (componentwise) product of the outputs obtained from inputing $f_{0}$ and $g_{0}$ separately.
However, particle methods converge much slower than their spectral counterparts when the function $f$ is highly differentiable~\cite{Gottlieb2001}.

In the case where $M$ is the unit circle, $S^{1}$, a spectral method can be obtained by converting \eqref{eq:density pde} to the Fourier domain where it takes the form
of an Ordinary Differential Equation (ODE):
$
	\frac{d \hat{\rho}_{k}}{dt} + 2\pi i k  \widehat{X}_{k-\ell} \hat{f}_{\ell} 
$
where $\hat{\rho}_{k}$ and $\widehat{X}_{k}$ denote the Fourier transforms of $\rho$ and $X$ ~\cite{Taylor1974}.
In particular, this transformation converts \eqref{eq:density pde} into an ODE on the space of Fourier coefficients.
A standard spectral Galerkin discretization is obtained by series truncation. 
%A good numerical algorithm is obtained by considering only the first $2n+1$ such coefficients.

Such a numerical method is good for $C^{k}$-data, in the sense that the convergence rate, over a fixed finite time $T>0$, is faster than $\mathcal{O}(N^{-k})$  where $N$ is the order of truncation~\cite{Gottlieb2001,Gottlieb1977numerical}.
In particular, spectral schemes converge faster than particle methods when the initial conditions have some degree of regularity.
Unfortunately the spectral algorithm given above is not \emph{qualitatively accurate}, as is demonstrated by several examples in Section \ref{sec:numerics}.

In summary, the current status quo is one wherein we must sacrifice either rapid convergence or qualitative accuracy.
The goal of this paper is to change the status quo and achieve both simultaneously.  In particular, our goal is
\emph{to find a numerical algorithm for \eqref{eq:function pde} and \eqref{eq:density pde} which is simultaneously stable, spectrally convergent, and qualitatively accurate.}

\subsection{Previous work}
Within mechanics, spectral methods for the continuum and transport equation are common-place where they are viewed as special cases of first order hyperbolic PDEs~\cite{Gottlieb2001}.
Various Galerkin discretizations of the Koopman operator have been successfully used for generic dynamic systems~\cite{BudisicMohrMezic2012,Mezic2005}, most notably fluid systems~\cite{Rowley2009} where such discretizations serve as a generalization of dynamic mode decomposition~\cite{Schmid2010}.
Dually, Ulam-type discretizations of the Frobenius-Perron operator~\cite{LasotaMackey1994,Ulam1947} have been used to find invariant manifolds of systems with uniform Gaussian noise~\cite{FroylandJungeKoltai2013,FroylandPadberg2009}.
In continuous time, Petrov-Galerkin discretization of the infinitesimal generator of the Frobenius Perron operator converge in the presence of noise ~\cite{BittracherKoltaiJunge2015} and preserve positivity in a Haar basis~\cite{koltai2011thesis}.
%The goal of this article is different than many of the papers cited thus far, in that we are interested in resolving our PDEs in finite time, rather than determining the infinite time behavior.
%Both of these representation of diffeomorphisms are natural, in the sense that the Koopman operator is the natural action of diffeomorphisms upon functions, and therefore must preserve the natural norm associated to functions, the sup-norm.
%Dually, the Frobenius-Perron operator (and it's discretization, the Transfer operator), represents the natural action of diffeomorphisms upon distributions and preserves the $L^{1}$-norm (the norm dual to the sup-norm).

%In this article, we consider a unitary representation of the diffeomorphisms of $M$ known to representation theorists~\cite{Ismagilov1975,VershilGelfandGraev1975} and quantum probability theorists~\cite{Meyer1998}.
%To be more specific, we consider a unitary action of diffeomorphisms on $L^2(M)$.
%One of the benefits of working on $L^2(M)$, instead of the space of probability densities, is that $L^2(M)$ is a vector-space, while the space of probability densities is not.
%We then square the elements of $L^2(M)$ in order to obtain desired results for probability densities.
%This tactic of using the square-root of an abstract object in order to simplify a problem has been used throughout mathematics.
%The most familiar example would be the invention of the complex numbers to find the roots of polynomials.
%A more modern example within applied mathematics can be found in~\cite{Balci2011} where the (conic) space of positive semi-definite tensor fields which occur in non-Newtonian fluids is transformed into the (vector) space of symmetric tensors.
%Similarly,~\cite{Crane2013} transform the mean-curvature flow PDE into a PDE on the space of half-densities to achieve superior numerical properties.

\subsection{Main contributions}

In this paper we develop numerical schemes for \eqref{eq:function pde} and \eqref{eq:density pde}.
We first pose an auxiliary PDE, \eqref{eq:half density pde}, which we can solve in lieu of \eqref{eq:function pde} and \eqref{eq:density pde}.
We relate solutions of \eqref{eq:half density pde} to solutions of \eqref{eq:function pde} and \eqref{eq:density pde} in Theorem \ref{thm:quantize}.
Second, we pose an auxiliary spectral scheme for \eqref{eq:half density pde} in Section \ref{sec:discretization}.
Our auxiliary scheme induces numerical schemes for \eqref{eq:function pde} and \eqref{eq:density pde} via Theorem \ref{thm:quantize}.
Third, we derive a spectral convergence rate for our auxiliary scheme in Section \ref{sec:analysis}.
The spectral convergence rate for our auxiliary scheme induces spectral convergence rates for numerical schemes for \eqref{eq:function pde} and \eqref{eq:density pde}.
Finally, we prove our schemes are qualitatively accurate, as in Definition \ref{def:quality}, in Section \ref{sec:qualitative}.
We end the paper by demonstrating these findings in numerical experiments in Section \ref{sec:numerics}.
We observe our algorithm for \eqref{eq:density pde} to be superior to a standard spectral Galerkin discretization, both in terms of numerical accuracy and qualitative accuracy.

\todo[inline]{This is too detailed}

\subsection{Notation}
Throughout the paper $M$ denotes a smooth compact $n$-manifold without boundary. 
The space of continuous functions is denoted $C(M)$ and has a topology induced by the sup-norm, $\| \cdot \|_{\infty}$ (see~\cite{Taylor1974,Conway1990}).
Given a separable Hilbert space $\mathcal{H}$ we denote the Banach-algebra of bounded operators by $B( \mathcal{H})$ and topological group of unitary operators by $U( \mathcal{H})$.
The adjoint of an operator $L : \mathcal{H} \to \mathcal{H}$ is denoted by $L^{\dagger}$.
The trace of a trace class operator, $L$, is denoted by $\Tr(L)$.
The commutator bracket for operators $A,B$ on $\mathcal{H}$ is denoted by $[A,B] := A \cdot B - B \cdot A$ (see~\cite{Conway1990}).
Finally, we will use the term ``canonical''  with respect to the category of smooth manifolds.
For example, we could not say that a vector-field is divergence free, because divergence is only well-defined with respect to a reference volume form and there is no canonical volume form associated to a smooth manifold.

%In the sequel we shall say that $\psi \in L^2(M)$ is of class $H^s$ if there exists $f \in H^s(M,g)$ such that $\psi = f \sqrt{\mu_g}$.

\section{The canonical Hilbert space of a manifold}
\label{sec:L2}
For the moment, assume $M$ is orientable and let $\mu$ be a volume form on $M$.
Given $\mu$ we may define the $L^2_{\mu}$-inner product
\begin{align*}
	\langle f, g \rangle_{L^2_\mu} := \int_M ( f \cdot g) \cdot \mu
\end{align*}
for functions $f,g \in C^0(M)$.
If we complete the resulting inner-product space we obtain the Hilbert space, $L^2_\mu(M)$.
In the case where $M$ is non-orientable we can perform virtually the same construction by replacing $\mu$ with a positive density \cite{Lee2006}.

It's notable that these constructions are not canonically associated to $M$, but only to the pair $(M, \mu)$.
If we change $\mu$, then the inner-products and norms are transformed as well.
However, there is a canonical Hilbert space associated to $M$, independent of an arbitrarily chosen $\mu$.
We obtain this space by dividing by the following equivalence relation.
We we can consider pairs of functions and volume forms, $(f,\mu)$, where $f \in L^2_\mu(M)$.
We say that $(f_1, \mu_1) \sim (f_2,\mu_2)$ if there exists a positive function, $\phi$, such that $f_1 = \phi^{1/2} \cdot f_2$ and $\phi \cdot \mu_1 = \mu_2$.
In fact, $\sim$, is an equivalence relation and so we may consider the space of equivalence classes.
In particular, we define the \emph{canonical Hilbert space of $M$} to be
\begin{align*}
	L^2(M) := \{ L^2_\mu(M) \times \{ \mu \} \mid \mu \in \operatorname{Vol}(M) \} / \sim.
\end{align*}
By construction, $L^2(M)$ is a vector-space with the addition operator defined independently of any reference to a volume form (or positive density).
As topological vector-space $L^2(M)$ is isomorphic to $L^2_\mu(M)$ for a fixed $\mu$.
Thus, for any $\psi \in L^2(M)$ and any volume form $\mu$, there is a unique $f \in L^2_\mu(M)$ such that $\psi = (f,\mu) / \sim$.
Therefore, we can define a bijection $i_{\mu} : L^2(M) \to L^2_\mu(M)$.

For any two elements $\psi_1, \psi_2 \in L^2(M)$ we can define the canonical inner-product
\begin{align}
	\langle \psi_1 \mid \psi_2 \rangle := \int_M (i_{\mu}( \psi_1) \cdot i_{\mu}( \psi_2) ) \cdot \mu \label{eq:canonical inner product}
\end{align}
for an arbitrary $\mu \in \operatorname{Vol}(M)$.

\begin{proposition}
	The right hand side of \eqref{eq:canonical inner product} is defined independently of $\mu$.
\end{proposition}
\begin{proof}
	Let $\mu'$ be another volume form.
	Then there exists a positive function $\phi$ such that $\mu' = \phi \mu$.
	Moreover, Let $f_1' = i_{\mu'}( \psi_1)$ (that is to say, $f_1' \in L^2_{\mu'}(M)$ is the unique element such that $\psi_1 = (  f_1', \mu' ) / \sim$).
	Then it must be the case that $f_1' = \phi^{-1/2} \cdot f_1$ because $\sim$ is an equivalence relation and $\psi_1 = (f_1,\mu) / \sim$.
	Similarly, $\psi_2 = ( f_2', \mu' ) / \sim$ for $f_2' = \phi^{-1/2} \cdot f_2$.
	The right hand side of \eqref{eq:canonical inner product} can be written in terms of the primed variables as
	\begin{align*}
		\int_M (f_1 \cdot f_2) \cdot \mu &= \int_M ( (\phi^{-1/2} \cdot f_1) \cdot (\phi^{-1/2} \cdot f_2) ) \cdot (\phi \cdot \mu) \\
			&= \int_M ( f_1' \cdot f_2') \cdot \mu'.
	\end{align*}
	However, this is nothing but $\langle \psi_1 \mid \psi_2 \rangle$ written in terms of the volume form $\mu'$.
\end{proof}

Locally, we may understand elements of $L^2(M)$ by how they transform under a change of coordinates.
The choice of a local coordinate system induces a choice of a local volume form, given by the flat metric on $\mathbb{R}^n$,
and so an element $\psi \in L^2(M)$ can, locally, be pictured as a square integrable function $\psi(x)$.
Under a local change of coordinations, $\Phi$, the element $\psi$ transforms as
\begin{align}
	\Phi_*\psi(x) = | \det( D\Phi^{-1}(x) |^{1/2} \, \psi( \Phi^{-1}(x) ). \label{eq:coordinate transformation}
\end{align}

From the perspective of transformation theory, it is abundantly clear that elements of $L^2(M)$ are not functions,
as the law for transforming functions would send $f(x)$ to $f( \Phi^{-1}(x))$.
The reason for the multiplication by $| \det( D\Phi^{-1}(x) |^{1/2}$ is because $\Phi$ warps the volume of space, and the local volume form is being used in order to depict $\psi$ as a function.
Said differently, elements of $L^2(M)$ are a distinct geometric objects, known as a \emph{half-densities}~\cite{BatesWeinstein1997,GuilleminSternberg1970}.
The origin of this terminology comes from the following observation.  If $\rho = \psi^2$, then the change of coordinate formula for $\rho$ is
\begin{align*}
	\Phi_*\rho(x) = | \det( D\Phi^{-1}(x)) | \, \rho( \Phi^{-1}(x) ).
\end{align*}
This is nothing but the change of coordinate formula for a density \cite{Lee2006}.
Therefore, half-densities are objects that yield densities when you square them.
In fact, for any two half-densities $\psi_1, \psi_2 \in L^2(M)$, the product obtained from point-wise multiplication, $\psi_1 \cdot \psi_2$,  is a density.
As a density can be integrated, we can write the inner-product on $L^2(M)$ more simply as
\begin{align*}
	\langle \psi_1 \mid \psi_2 \rangle = \int_M \psi_1 \cdot \psi_2.
\end{align*}

As the integration is a canonical operation on $M$ we observe the following.
\begin{proposition} \label{prop:unitary 1}
	Diffeomorphisms of $M$ act unitarily on $L^2(M)$.
\end{proposition}
\begin{proof}
	Locally, the action of a diffeomorphism, $\Phi: M \to M$, is given by the change of coordinates formula \eqref{eq:coordinate transformation}.
	For an arbitrary half-density $\psi$ we observe
	\begin{align*}
		\| \Phi_* \psi \|_{L^2}^2 &= \langle \Phi_* \psi \mid \Phi_* \psi \rangle \\
		&= \int_M | \det( D\Phi^{-1}(x) \, \psi( \Phi^{-1}(x) )^2 dx.
	\end{align*}
	By the change of variables formula with the change of variable $x' = \Phi(x)$ we find
	\begin{align*}
		= \int_M \psi(x )^2 dx = \| \psi \|_{L^2}^2
	\end{align*}
	As $\psi$ was chosen arbitrarily, we have observe that $\Phi$ preserves the $L^2$-norm.
	By polarization, $\Phi$ also preserves the inner-product $\langle \cdot \mid \cdot \rangle$,
	and therefore $\Phi$ acts unitarily on $L^2(M)$.\footnote{Strictly speaking, the integrals in this proof should be computed with respect to a partition of unity.  However, the notational complexity incurred was hard to justify in light of the clarity that was lost when we did this.}
\end{proof}

For the purposes of this paper, it is very important that $L^2(M)$ consist of entities distinct from functions.
Without such a distinction, we will run into ambiguities and contradictions.
For example, in later sections we will canonically embed $C^0(M)$ into the space of Hermitian operators on $L^2(M)$.
We will find that deformations of $M$ act on $L^2(M)$, and thus induce an actions on operators of $L^2(M)$ which descends to the standard action of a deformation on $C^0(M)$.
However, if $C^0(M)$, also embedded in $L^2(M)$ we would have two group actions to consider on $C^0(M)$ with no discernible reason to prefer one over the other.
Thankfully, no such ambiguity arises since $C^0(M)$ does not embed into $L^2(M)$ canonically.

\section{Sobolev spaces}
Just as there is a canonical space $L^2(M)$, there is also a canonical space $H^s(M)$.
We define $H^s(M)$ as a subspace of $L^2(M)$ with certain regularity properties.
In particular, the Lie derivative of $\psi \in L^2(M)$ with respect to a vector field, $X \in \mathfrak{X}(M)$, is given by
\begin{align*}
	\pounds_X[ \psi] := - \frac{d}{dt} ( \Phi^{t}_X )_*\psi
\end{align*}
Where $\Phi^t_X$ is the time-$t$ flow of $X$, and $( \Phi^{t}_X )_*\psi$ is locally represented by \eqref{eq:coordinate transformation}.
In local coordinates where $X(x) = \sum_{i=1}^{n} X^i(x) \frac{ \partial}{ \partial x^i}$ the Lie derivative is
\begin{align}
	\pounds_X [\psi] = \frac{1}{2} \left( \sum_{i=1}^{n} X^i \partial_i \psi + \partial_i (\psi X^i) \right) \label{eq:representation}
\end{align}
As the Lie derivative operator is nothing but the action of an infinitesimal unitary transformation (this is Proposition \ref{prop:unitary 1}), we obtain the following corollary.
\begin{corollary}
	The Lie-derivative operator is anti-symmetric with respect to the  $L^2$-inner product on the subspace in which it is bounded.
\end{corollary}
As $\pounds_X$ is an (unbounded) anti-symmetric operator, we may take fractional powers\todo{Not sure this really makes sense for anti-symmetric operators.  You might need to complexify $L^2$ and multiply the operator by $i$} of it in order to define the space $H^s(M)$ as
\begin{align*}
	H^s(M) := \{ \psi \in L^2(M) \mid \| (\pounds_X)^{s} \cdot \psi \| < \infty, \forall X \in \mathfrak{X}(M) \}.
\end{align*}

This definition of $H^s(M)$ in terms of semi-norms is a generalization of the standard definition on $\mathbb{R}^n$ using the seminorms $\| \partial_k^s f \|_{L^2}$.
However, for the purposes of analysis, it will be convenient to refer to a single $H^s$ norm, rather than a family of semi-norms.
There is no canonical choice, so we are forced to non-canonically choose one.
The clearest way to do this is to arbitrarily choose a Riemmanian metric, $g$.\footnote{We know such a metric exists as long as $M$ is paracompact.}
The choice in metric induces a Riemannian density, $\mu_g$, and a Laplace-Beltrami operator, $\Delta_g$.
We then define the $H^s$-norm with respect to $g$ as
\begin{align*}
	\| \psi \|_{H^s_g}^2 := \int_M f \cdot [ (1-\Delta_g)^s \cdot f ] \cdot \mu_g
\end{align*}
where $f = i_{\mu_g}(\psi)$.
It is fairly clear from merely counting derivatives in a local coordinate chart that $\psi \in H^s(M)$ if and only if $\| \psi \|_{H^s_g} < \infty$.
We will not concern ourselves with how to choose a metric $g$.
When we write $\| \cdot \|_{H^s}$ we will imply that an arbitrary metric has been chosen.

\section{Quantization} \label{sec:quantization}
In physics, ``quantization'' refers to the process of substituting certain physically relevant functions with operators on a Hilbert space, while attempting to preserve the symmetries and conservation laws of the classical theory~\cite{BatesWeinstein1997,GuilleminSternberg1970}.
In this section, we quantize \eqref{eq:function pde} and \eqref{eq:density pde} by replacing functions and densities with bounded and trace-class operators on $L^{2}(M)$.
This is useful in Section \ref{sec:discretization} when we discretize.

To begin, let us quantize the space of continuous real-valued functions $C(M)$.
For each $f \in C(M)$, there is a unique bounded Hermitian operator, $H_{f} : L^{2}(M) \to L^{2}(M)$ given by scalar multiplication.
That is to say $(H_{f} \cdot \psi) (x) = f(x) \psi(x)$ for any $\psi \in L^{2}(M)$.
By inspection one can observe that the map ``$f \mapsto H_{f}$'' is a monomorphism from the algebra $C(M)$ into $\operatorname{B}( L^2(M))$ because $H_{f\cdot g + h} = H_{f} \cdot H_{g} + H_{h}$ and $\| H_{f} \|_{op} = \| f \|_{\infty}$.

Dually, for any trace class operator $A$ there is a unique $\rho_{A} \in C(M)'$ such that: 
\begin{align*}
	 \int_M f \, \rho_{A} d\bf{x} = \Tr ( H_{f}^{\dagger} \cdot A )
\end{align*}
for any $f \in C(M)$.
Said differently, the map ``$A \mapsto \rho_{A}$'' is the adjoint of the map ``$f \mapsto H_{f}$''. Therefore ``$A \mapsto \rho_{A}$'' is an epimorphism (i.e. surjective).


By Stone's theorem, $\pounds_X$ is the infinitesimal generator of a one-parameter semi-group on the topological Lie group $\operatorname{U}(L^2(M))$.
We can relate this transformation to the flow of the vector field $\Phi_X^t:M \to M$ in a precise sense.
In particular
\begin{align*}
	( e^{\pounds_X} \cdot \psi )(x) =  \det( D [(\Phi_X^t)^{-1}](x) )^{1/2} \psi( ( \Phi_X^t)^{-1} (x) ).
\end{align*}

%By construction, these maps preserve the duality between functions and distributions.

%Finally, for any vector field $X$ there is a unique (unbounded) anti-symmetric operator $\pounds_{X}$ on $L^{2}(M)$
%given in coordinates by
%\begin{align}
%	\pounds_{X} [ \psi ] = \frac{1}{2} X^{j} \pder{\psi}{x^{j}} + \frac{1}{2} \pder{}{x^{j}} ( \psi \, X^{j} ), \label{eq:representation}
%\end{align}
%where the right hand-side is written using the Einstein summation convention in a local coordinate system.
%After some minor computations (see Appendix \ref{app:Lie} \todo{need to write an appendix} ) we see that $\pi$ is a Lie algebra morphism which sends
%the Jacobi-Lie bracket to (minus) the commutator bracket.  That is to say, $\pi$ is linear and $\pi([X,Y]) = - [ \pounds_{X} , \pi(Y)]$.

%\begin{example}
%Let us describe what this means when $M$ is a torus.
%In standard coordinates $\theta = (\theta^{1},\dots,\theta^{d})$ we may write $X = X^{i}(\theta) \frac{\partial}{\partial \theta^{i}}$ for some functions $X^{1}(\theta),\dots,X^{d}(\theta)$.
%In a Fourier basis $\{ \frac{1}{\sqrt{2\pi}} e^{ i \langle k , \theta \rangle}   \mid k \in \mathbb{Z}^{d} \}$ 
%a half density, $\psi$ is given by it's Fourier series $\mathcal{F}[\psi]$.
%Upon noting that $\mathcal{F}[ f \cdot \psi] = \mathcal{F}[f] * \mathcal{F}[\psi]$
%we find $\hat{f} = \mathcal{F}[f] * $, i.e. $\hat{f}$ is the convolution operator associated to the Fourier transform of $f$.
%We observe that $\pounds_{ \pder{}{\theta^{j}} } [ e^{i \langle k , \theta \rangle}]  = i k_{j} e^{i \langle k,\theta\rangle}$.
%That is to say, $\pounds_{ \pder{}{\theta^{j}} }$ simply multiplies the $k = (k_{1},\dots,k_{d})$-th mode by $k^{j}$.
%This is the sparsest representation of this operator one can ever expect to obtain.
%We then see that $\pounds_{X} [\psi] = \mathcal{F}[X^{j}] *  \left( \pounds_{ \pder{}{\theta^{j}} }[ \psi ] \right)$.
%If $X$ is smooth, than $\mathcal{F}(X^{j})$ is well approximated by a sparse operator by truncation.
%As a result, we have a sparse spectral approximation of $\pounds_{X}$ when we use truncation.
%
%Finally, given a sufficiently regular\footnote{e.g. $W^{1+\epsilon,1}$ for $\epsilon >0$ will do.} density, $\rho$,  we could 
%split $\rho$ into non-negative and non-positive components as $\rho = \rho^{+} - \rho^{-}$
%so that $\psi = \sqrt{\rho^{+}} + i \sqrt{\rho^{-}}$ is a square root of $\rho$.
%Then $\hat{\rho}$ is represented in the Fourier domain by $\mathcal{F}(\psi) \otimes \mathcal{F}(\psi)^{\dagger}$.
%\end{example}

We can now convert the evolution PDEs \eqref{eq:function pde} and \eqref{eq:density pde} into ODEs of operators on $L^{2}(M)$.

\begin{theorem} \label{thm:quantize}
	Let $X(t) \in \mathfrak{X}(M)$ be a time-dependent vector-field.
	Then $f$ satisfies \eqref{eq:function pde}
	if and only if $H_{f}$ satisfies
	\begin{align}
		\frac{d H_{f} }{dt} + [ H_{f} , \pounds_{X} ] = 0. \label{eq:quantum observable ode}
	\end{align}
	If $A$ is trace-class and satisfies
	\begin{align}
		\frac{dA}{dt} + [ A , \pounds_{X} ] = 0, \label{eq:quantum density ode}
	\end{align}
	then $\rho_{A}$ satisfies \eqref{eq:density pde}.
	Finally, if $\psi$ satisfies
	\begin{align}
		\partial_t \psi + \pounds_X[\psi] = 0 \label{eq:half density pde}
	\end{align}
	then $\rho_{A} = \psi^{2}$ satisfies \eqref{eq:density pde} and $\psi \otimes \psi^{\dagger}$ satisfies \eqref{eq:quantum density ode}.
\end{theorem}

\begin{proof}
	Let $f$ satisfy \eqref{eq:function pde}.
	For an arbitrary $\psi \in L^{2}(M)$ we observe that $[ H_{f} , \pounds_{X}] \cdot \psi$ is given by:
	\begin{align*}
		\left( [ H_{f}, \pounds_{X} ] \cdot \psi \right)(x) &= f(x) \sum_{j=1}^{n} \left( \frac{1}{2} X^{j} \pder{\psi}{x^{j}} + \frac{1}{2} \pder{}{x^{j}} ( \psi \, X^{j} ) \right) (x) \\
			&\quad- \frac{1}{2} X^{j} \left. \pder{}{x^{j}} \right|_{x}( f \psi)  + \frac{1}{2} \left. \pder{}{x^{j}} \right|_{x}(f \psi \, X^{j} )
	\end{align*}
	where we have used \eqref{eq:representation}.  
	Application of the product rule to each of these terms yields a number of cancellations and we find:
	\begin{align*}
		[ H_{f} , \pounds_{X} ] \cdot \psi = - X^{j} \pder{f}{x^{j}} \psi = (\partial_{t} f )\psi = \frac{d H_{f} }{dt} \cdot \psi.
	\end{align*}
	As $\psi$ is arbitrary, we have shown that $H_{f}$ satisfies \eqref{eq:quantum observable ode}.
	Each line of reasoning is reversible, and so we have proven the converse as well.
	This proves the first claim.
	
	For the second claim let $f$ be an arbitrary time-dependent continuous function.
	Then we find
	\begin{align*}
		\int ( \partial_t \rho_A ) \, f dx = \Tr( H_f^\dagger \partial_t A ) = \Tr( H_f^\dagger \cdot [A , \pounds_X] ) \\
		= \Tr( [\pounds_X,H_f]^\dagger A) \\
		\intertext{By the previous claim the above expression is equivalent to}
		= \int_M \left( \sum_{i=1}^{n} X^i \partial_i f \right) \rho_A dx \\
		= - \int_M f \, \left(\sum_{i=1}^{n} \partial_i (\rho_A X^i ) \right) dx
	\end{align*}
	where the boundary terms vanish because $X$ is tangential to $M$.
%	
%	Thirdly, if $Y$ satisfies \eqref{eq:vector field pde}, then we observe 
%	\begin{align}
%		\frac{d}{dt} \pi(Y) = \pi ( \partial_{t} Y ) = \pi( - [X,Y] ) = [\pounds_{X} , \pi(Y) ].
%	\end{align}
%	where we have used the fact that $\pi$ is bracket preserving.
%	
	Lastly, if $\psi$ satisfies \eqref{eq:half density pde} and $\rho = \psi^{2}$ then we see
	\begin{align*}
		\partial_{t} \rho &= \partial_{t} ( \psi^{2}) = 2 (\partial_{t} \psi ) \, \psi \\
		&= - 2 \left( - \frac{1}{2} \partial_{i} (\psi X^{i}) - \frac{1}{2} X^{i} \partial_{i} \psi \right) \psi 
		= \left( - X^{i} \partial_{i} \psi - \psi \partial_{i} X^{i}  \right) \psi \\
		&= - 2 \psi (\partial_{i} \psi) X^{i} - (\partial_{i}X^{i}) \psi^{2}
		= - \partial_{i}(\rho) X^{i} - (\partial_{i}X^{i}) \rho = - \partial_{i} ( \rho X^{i}).
	\end{align*}
\end{proof}


The benefit of using \eqref{eq:quantum observable ode} and \eqref{eq:quantum density ode} to represent the PDEs of concern is that \eqref{eq:quantum observable ode} and \eqref{eq:quantum density ode} may be discretized using a standard least squares projections on $L^{2}(M)$ without sacrificing qualitative accuracy.
%In order to demonstrate this, we will illustrate a detailed implementation of how this would be done on the unit circle, $S^1$, before considering the case of a general compact manifold.

%\subsection{Discretization on $S^1$ using the Fourier Transform}
%In the case of $S^1$ we can discretize all the needed concepts using the Fourier transform.  In particular, let us consider the ODE $\dot{x} = g(x)$ where
%$g(x)$ is a continuous function of $x \in S^1$.
%Then the operator $\pounds_{X}$ is given by
%\begin{align}
%	\left( \pounds_{X} \cdot \psi \right)(x) = \frac{1}{2}
%	\left( g(x) \left.\frac{d\psi}{dx}\right|_x 
%	+ \left. \frac{d}{dx} \right|_x (g \cdot \psi ) \right). \label{eq:S1 op}
%\end{align}
%
%We will first describe how one can approximate the operator $\pounds_{X}$ with an operator on $\mathbb{C}^{2n+1}$ for a finite $n > 0$.
%In essence what we will describe is a standard spectral scheme ~\cite{Boyd2001,NumericalRecipes}.
%To begin, note that $\pounds_{X}$ consists of either multiplication by $g(x)$, or differentiation, or multiplication by $1/2$.  So our approach will be to discretize the linear operations of multiplication by $g(x)$ and the linear operation of differentiation.
%
%The first step is to transform everything to the Fourier domain.  Any $\psi \in L^2(M)$ can be viewed as a normal $L^2$-function with respect to the standard Haar measure on $S^1$.  We may then apply the Fourier transform to write $\psi$ as a complex series
%\begin{align}
%	\psi(x) = \sum_{k=-\infty}^\infty c_k e^{2\pi i k x}.
%\end{align}
%We find that differentiation takes the form
%\begin{align}
%	\frac{d}{dx} (\psi)(x) = \sum_{k} 2\pi i k c_k e^{2\pi i kx}.
%\end{align}
%Thus, in the Fourier domain, differentiation is given by
%\begin{align}
% 	c_k \mapsto 2 \pi ik c_k
%\end{align}
%for all $k \in \mathbb{Z}$.
%For any $N \in \mathbb{N}$ we may approximate the differentiation operator with a complex matrix
%\begin{align*}
%	[D_N]_{k \ell } = \delta_{k \ell } 2\pi i k
%\end{align*}
%for $k,\ell \in \{ -N , \dots,-1,0,1,\dots N \}$.
%If we define $\mathbf{c}_n = ( c_{-n}, \dots , c_{-1} , c_0 , c_{1},\dots,c_n ) \in \mathbb{C}^{2n+1}$, the vector $D_n \cdot {\bf c}_n$ is the truncated Fourier series of $\frac{d\psi}{dx}$.
%
%Similarly we may take the Fourier transform of the function $g$ to get the Fourier series expansion
%\begin{align}
%	g(x) = \sum_k g_k e^{2\pi i kx}.
%\end{align}
%Multiplication of $\psi \in L^2(S^1)$ by $g \in C^0(M)$ is given by
%\begin{align}
%	g(x) \cdot \psi(x) &= \sum_{k \ell} g_\ell c_k e^{2\pi i (k+\ell)x} \\
%		&= \sum_{k \ell} g_{k-\ell} c_k e^{2\pi i kx}.
%\end{align}
%In other-words, the multiplication operator $\hat{g}$ is nothing but the convolution operator
%\begin{align}
%	( \hat{g} \cdot \psi )(x) = \sum_{k \ell} g_{k-\ell} c_k e^{2\pi i kx}.
%\end{align}
%
%Again, we can approximate $\hat{g}$ with a complex $(2N+1) \times (2N+1)$ matrix
%\begin{align}
%	[\hat{G}_N]_{k\ell} = g_{k - \ell}
%\end{align}
%for $k,\ell \in \{ -N , \dots,-1,0,1,\dots,N\}$.
%We will find that $\hat{G}_N$ converges to $\hat{g}$ as $n$ goes to infinity.
%As a result the matrix-vector computation
%\begin{align}
%	 {\bf d}_N = {\bf X}_N \cdot {\bf c}_N
%\end{align}
%where
%\begin{align}
%	{\bf X}_N = \frac{1}{2} \hat{G}_N \cdot D_N + \frac{1}{2} D_N \cdot \hat{G}_N
%\end{align}
%serves as an approximation of the truncated Fourier series to \eqref{eq:S1 op}.
%We will see that this approximation converges to order $\mathcal{O}( N^{1-s} )$ on the subspace $H^{s} \subset L^{2}$.
%
%This gives us the following numerical scheme for \eqref{eq:half density pde} for a fixed $n$:
%
%\begin{enumerate}
%	\item Given the initial condition $\psi(0) \in L^2(S^1)$ compute ${\bf c}_N(0)$.
%	\item Solve the ode $\frac{d {\bf c}_N }{dt} = {\bf X}_N \cdot {\bf c}_N$ over a finite time interval, $[0,T]$,
%	with a trusted ode solver.\footnote{If ${\bf X}_n$ is constant in time, than one can solve this ode using a matrix exponential, but this could be treacherous
%	and needlessly expensive ~\cite{Moler2003}.}
%	\item Let $\psi_{N}(x,t) = \sum_{k=-N}^N c_k(t) e^{2\pi ikx}$. 
%\end{enumerate}
%We will later find that $\psi_{N}$ converges to the solution of \eqref{eq:half density pde} at a rate $\mathcal{O}( N^{1-s})$ when $\psi(0) \in H^{s}(M)$ for $s > 1$.
%Moreover, we will find that $\rho^{(n)} = ( \psi^{(n)} )^2$ converges to solutions of \eqref{eq:density pde} at the same rate.
%
%Lastly, we can approximate solutions to \eqref{eq:function pde}
%by discretizing \eqref{eq:quantum observable ode} in a similar way.
%Given an initial condition $f(x,0) \in C^0(M)$ we can compute the truncated Fourier series $f_{-n},\dots,f_{-1},f_0,f_1,\dots,f_n$ and create the convolution matrix
%\begin{align*}
%	[ \widehat{F}_n(0) ]_{k \ell} = f_{k-\ell}.
%\end{align*}
%Again, $\widehat{F}_n(0)$ is a truncated approximation of the operator $\widehat{f( \cdot , 0)}$.
%We then can approximate a solution to \eqref{eq:quantum observable ode}
% by integrating the finite-dimensional matrix ode
%\begin{align*}
%	\frac{d \widehat{F}_n }{dt} + [ \widehat{F}_n , {\bf X}_n ] = 0.
%\end{align*}
%
%Conversion of the matrix $\widehat{F}_n$ is admittedly a problem with this approach.  Another problem with this approach is the potential storage cost.

\section{Discretization} \label{sec:discretization}
This section presents the numerical algorithms for solving \eqref{eq:function pde} and \eqref{eq:density pde}.
The basic ingredient for all the algorithms in this section are a Hilbert basis and an ODE solver.
Denote a Hilbert basis by $\{ e_{0}, e_{1},\dots \}$ for $L^{2}(M)$.
For example, we may use the eigen-functions of the Laplace operator.
This is known as the Fourier basis.
To ensure convergence, we assume:
\begin{ass} \label{ass:basis}
	Our basis $\{ e_{k} \}$ is such that there exists a metric $g$ for which the unitary transformation which sends the basis $\{ e_{k} \}$ to the Fourier basis is bounded with respect to the $\| \cdot \|_{s,2}$-norm for some $s > 1$.
\end{ass}

%\noindent Assumption \ref{ass:basis} holds for a variety of choices, such as the Fourier basis itself, as well as any Sturm-Liouville basis (e.g. Legendre functions) \ram{citation}.

In this section we provide a spectral discretization of space in order to convert the PDEs \eqref{eq:function pde} and \eqref{eq:density pde} into ODEs.
Sometimes this is referred to as a semi-discretization~\cite{Gottlieb1977numerical}.
In particular, we will assume access to a finite dimensional ODE solver, denoted ``$\OdeSolve$.'' whose time-step discretization error is dwarfed by the spatial discretization error of our semi-discretization. 
In practice a high-order Runge-Kutta method or a well tested software library such as ~\cite{VODE} could be used.
Most notably, the method of~\cite{Calvo1997} is specialized to isospectral flows such as  \eqref{eq:quantum observable ode} and \eqref{eq:quantum density ode} by using discrete-time isospectral flows.
More explicitly, let $\OdeSolve ( F , x_{0} , t )$ denote the numerically computed solution $x(t)$ to the ODE ``$\dot{x} = F(x)$'' at time $t \in \mathbb{R}$, with initial condition $x_{0} \in M$.
Before constructing an algorithm to spectrally discretize \eqref{eq:function pde} and \eqref{eq:density pde} in a qualitatively accurate manner, we first solve \eqref{eq:half density pde} using a spectral Galerkin discretization in Algorithm \ref{alg:half density}.

\begin{algorithm}
\begin{algorithmic}
	\REQUIRE $\psi(0) \in L^{2}(M)$, $t \in \mathbb{R}$, $N \in \mathbb{N}$.
	\STATE initialize $z(0) = \vec{0} \in \mathbb{C}^{N}$.
	\STATE initialize $X_{N} = [0] \in \mathbb{C}^{N \times N}$
	\FOR{ $i = 1 , \dots , N$}
		\STATE $[z(0)]_{i} = \int_{M} \bar{e}_{i}(x) \psi(0,x)$
		\FOR{$j=1,\dots,N$}
			\STATE $[X_{N}]\indices{^{i}_{j}} = \frac{1}{2} \int_{M} \bar{e}_{i}(x) ( X^{\alpha} \partial_{\alpha} e_{j} + \partial_{\alpha}( X^{\alpha} e_{j}) )(x)$
		\ENDFOR
	\ENDFOR
	\STATE initialize the function $F: \mathbb{C}^{N} \to \mathbb{C}^{N}$ given by $F(z) = X_{N} \cdot z$.
	\STATE $z(t) = \operatorname{OdeSolve}(  F , z(0) , t)$
	\RETURN  $\psi_{N}(t) = \sum_{i=1}^{n} [z(t)]_{i} e_{i}$.
\end{algorithmic}
\caption{A spectral discretization to solve \eqref{eq:half density pde} for half densities.} \label{alg:half density}
\end{algorithm}

To summarize, Algorithm \ref{alg:half density} produces a half-density $\psi_{N}(t_{k}) \in V_{N} = \operatorname{span}(e_1,\dots,e_N)$ by projecting \eqref{eq:half density pde} to $V_N$.
This projection is done by constructing the operator $X_{N} = \pi_{N} \circ \pounds_{X} |_{V_{N}}: V_{N} \to V_{N}$.
In Section \ref{sec:analysis} we prove that $\psi_{N}(t_{k})$ converges to the solution of \eqref{eq:half density pde} as $N \to \infty$.
We see that $\psi_{N}(t)$ evolves by unitary transformations, just as the exact solution to \eqref{eq:half density pde} does.
This correspondence is key in providing the qualitative accuracy of algorithms that follow, so we formally state it here.
\begin{proposition} \label{prop:unitary}
	The output of Algorithm \ref{alg:half density} is given by $U_{N}(t_{k}) \cdot \psi_{N}(0)$ when $\psi(0) \in L^2(M)$ is the input to Algorithm \ref{alg:half density} where $\psi_{N}(0) = \pi_{N}( \psi(0) )$ and $U_{N}(t)$ is the unitary operator generated by $X_{N}$.
\end{proposition}
\begin{proof}
	The operator $X_{N}$ in Algorithm \ref{alg:half density} is anti-Hermitian on $V_{N}$.
	It therefore generates a unitary action on $V_{N} \subset L^{2}(M)$ when inserted into $\operatorname{OdeSolve}$.
\end{proof}

Before continuing, we briefly state a sparsity result that aides in selecting a basis.
We say an operator $A : L^{2}(M) \to L^{2}(M)$ is \emph{sparse banded diagonal} with respect to a Hilbert basis $\{ e_{0} , e_{1},\dots\}$ if there exists an integer $W \in \mathbb{N}$
such that $A(e_{i})$ is a finite sum elements of the form $e_{i + \delta_{j}}$ for fewer than $W$ offsets $\delta_{j}$ for $i = 0,1,2, \dots$.
\begin{theorem} \label{thm:sparsity}
	If $\pounds_{\pder{}{x^{j}}}$ and $H_{f_{k}}$ are sparse banded diagonal, 
	and if the vector-field $X$ is given in local coordinates by $X^{i} = \sum_{k} c_{k}^{i} f_{k}$ with fewer than $W>0$ of $c^{i}_{k}$'s being non-zero for each $i=1,\dots,n$, then the matrix $X_{N}$ in Algorithm \ref{alg:half density} is sparse banded diagonal and the sparsity of $X_{N}$ is $\mathcal{O}( W / N )$.
\end{theorem}
\begin{proof}
The result follows directly from counting.
\end{proof}

Theorem \ref{thm:sparsity} suggests selecting a basis where $W$ is small, or at least finite.
For example, if $M$ were a torus, and the vector-field was made up of a finite number of sinusoids, then a Fourier basis would yield a $W$ equal to the maximum number of terms along all dimensions.

By Theorem \ref{thm:quantize}, the square of the result of Algorithm \ref{alg:half density} is a numerical solution to \eqref{eq:density pde}.
We can use this to produce a numerical scheme to \eqref{eq:density pde} by finding the square root of a density.
Given a $\rho \in L^1(M)$ which admits a square root, let $\rho^{+}$ denote the positive part and $\rho^{-}$ denote the negative part so that $\rho = \rho^{+} - \rho^{-}$, 
then $\psi = \sqrt{\rho^{+}} - i \sqrt{\rho^{-}}$ is a square root of $\rho$ since $\rho = \psi^{2}$.
This yields Algorithm \ref{alg:density} to spectrally discretize \eqref{eq:density pde} in a qualitatively accurate manner for densities which admit a square root.

\begin{algorithm}
\begin{algorithmic}
	\REQUIRE $\rho(0) \in L^{1}(M), t \in \mathbb{R},N \in \mathbb{N}$.
	\STATE	Initialize $\psi(0) =  \sqrt{\rho^{+}(0)} - i \sqrt{\rho^{-}(0)}$
	\STATE	Set $\psi_{N}(t) =  \operatorname{ Algorithm\_ \ref{alg:half density} }( \psi(0) , t, N )$
	\RETURN $\rho_{N}(t , x) = \psi_{N}(t , x)^{2}$.
\end{algorithmic}
	\caption{A spectral discretization to solve \eqref{eq:density pde} for densities} \label{alg:density}
\end{algorithm}

Alternatively, we could have considered the trace-class operator $A_{N}(t_{k}) = \psi_{N}(t_{k}) \otimes \psi_{N}(t_{k})^{\dagger}$ as an output. 
This would be an numerical solution to \eqref{eq:quantum density ode}, and would be related to our original output in that $\rho_{N}(t_{k}) = \rho_{A_{N}(t_{k})}$.
Finally, we present an algorithm to solve \eqref{eq:quantum observable ode} (in lieu of solving \eqref{eq:function pde}).
This algorithm is presented for theoretical interest at the moment.

\begin{algorithm}[H]
\begin{algorithmic}
	\REQUIRE $f(0) \in C(M), t \in \mathbb{R}, N \in \mathbb{N}$.
	\STATE initialize $F_{N}(0), X_{n} \in \mathbb{C}^{N \times N}$.
	\STATE initialize the linear map $B: \mathbb{C}^{N \times N} \to \mathbb{C}^{N \times N}$ given by $B(H) = - [H , X_{N}]$.
	\FOR{ $i , j = 1 , \dots , N$}
		\STATE $[F_{N}(0)]\indices{^i_{j}} =  \int_{M} \bar{e}_{i}(x) f(x) e_{j}(x)$ 
		\STATE $[X_{N}]\indices{^i_{j}} = \frac{1}{2} \int_{M} \bar{e}_{i}(x) ( X^{\alpha} \partial_{\alpha} e_{j} + \partial_{\alpha}( X^{\alpha} e_{j}) )(x)$ 
	\ENDFOR
	\STATE $F_{N}(t) = \OdeSolve( B , F_{N}(0) , t)$
	\RETURN The (compact) operator $H_{f,N}(t_{k}) = \sum_{i,j=1}^{N}[ F_{N}(t_{k}) ] \indices{^{i}_{j}} e^{i} \otimes e_{j}^{\dagger}$.
\end{algorithmic}
	\caption{A spectral discretization to solve \eqref{eq:quantum observable ode} for functions} \label{alg:function}
\end{algorithm}

We find that the ouput of Algorithm \ref{alg:function} bears algebraic similarities similarities to the exact solution to the infinite dimensional ODE, \eqref{eq:quantum observable ode} (which is isomorphic to \eqref{eq:function pde} by Theorem \ref{thm:quantize}).
This is stated in a proposition analogous to Proposition \ref{prop:unitary}.

\begin{proposition} \label{prop:isospectral}
$H_{f,N}(t) = U_{N}(t) \cdot H_{f,N}(0) \cdot U_{N}(t)^{\dagger}$ for any $t \in \mathbb{R}$.
Moreover, $U_{N}(t)$ is identical to the unitary transformation of Proposition \ref{prop:unitary}.
Lastly, the exact solution of \eqref{eq:quantum observable ode} is of the form $H_{f}(t) = U(t) \cdot H_{f}(0)  \cdot U(t)^{\dagger}$ as well.
\end{proposition}
\begin{proof}
	This follows from the fact that algorithm outputs the solution to an isospectral flow ``$\dot{F}_{N} + [F_{N} , X_{N}]$''
	where $X_{N}$ is anti-Hermitian and that the $H_{f}$ satisfies the isospectral flow \eqref{eq:quantum observable ode}.
\end{proof}

%On the torus, a more practical approach which holds much of the numerical benefits would be to approximate $\hat{f}_{n}$ psuedo-spectrally,
%by evaluating $f$ on fixed grid points.
%Given the value of $f$ on a regular grid, one can efficiently compute (an approximation of) the Fourier series using the discrete Fourier transform.
%The corresponding operator $\hat{f}_{n}$ could then be reconstructed by assembling the convolution operator associated to the Fourier series.
%The resulting method is really the method of characteristics in disguise (i.e. a particle method).
%
%\begin{algorithm}[H]
%	\KwData{An initial condition $f(0) \in C( \mathbb{T}^{d})$, an ordered sequence of times $t_{1},\dots,t_{m} \in \mathbb{R}^{+}$, and an integer $n \in \mathbb{N}$.}
%	\KwResult{A numerical solution, $\hat{f}_{n}(t_{k})$, to \eqref{eq:quantum observable ode} for $k = 1,\dots,m$.}
%	initialize a regular grid, $\Omega_{n}$, of size $n = r^{d}$\;
%	\For{$x_{i} \in \Omega_{n}$}{
%		initialize $y_{i}(0) = x_{i}$\;
%	}
%	$t_{0} = 0$\;
%	\For{$k=1,\dots,m$}{
%		\For{$x_{i} \in \Omega_{n}$}{
%			$y_{i}(t_{k}) = \OdeSolve( X , y_{i}(t_{k-1}) , t_{k})$\;
%		}
%		$s_{k} = \mathcal{DFT}[ \{ f(y_{i}(t_{k}) ) \} ]$ \;
%	}
%	\KwOut{ The Operator $\hat{f}_{n}(t_{k}) = \sum_{i,j}^{n}[ s_{k}]_{i-j} e^{i} \otimes e^{j \dagger}$}
%	\caption{A psuedo-spectral algorithm for toric functions} \label{alg:function2}
%\end{algorithm}
%
%We should note that the use of the discrete Fourier transform introduces errors which disrupt the conservation laws we seek to keep.
%This is not a new algorithm, and is only introduced here as an alternative to Algorithm \ref{alg:function}.

\section{Error analysis} \label{sec:analysis}

In this sections we derive convergence rates.
We find that the error bound for Algorithm \ref{alg:half density} induces error bounds for the Algorithms \ref{alg:density} and \ref{alg:function}.
Therefore, we first derive a useful error bound for Algorithm \ref{alg:half density}.
Our proof is a generalization of the convergence proof in ~\cite{Pasciak1980}, where \eqref{eq:half density pde} is studied (modulo a factor of two time rescaling) on the torus.
We begin by proving an approximation bound.
In all that follows, let $\pi_{N}: L^{2}(M) \to V_{N}$ denote the orthogonal projection.

\begin{proposition} \label{prop:approximation}
	If $\psi \in H^{\bar{s}}(M)$ and $\bar{s} > s \geq 0$,
	then
	\begin{align*}
		\| \psi - \pi_{N}(\psi) \|_{s,2} <  \frac{n \, C_{\bar{s},s} }{ \bar{s}-s} \| \psi \|_{\bar{s} , 2} \, N^{-2(\bar{s}-s)/n}
	\end{align*}
	for some constant $C_{\bar{s},s}$ and $n = \dim(M)$.
\end{proposition}
\begin{proof}
	We can assume that $e_{1},e_{2},\dots$ is a Fourier basis.
	The results are unchanged upon applying Assumption \ref{ass:basis} and converting to the Fourier basis.
	Any $\psi \in H^{s}(M;g)$ can expanded as $\psi = \hat{\psi}_{k} e_{k}$ where $\hat{\psi}_{k} = \langle e_{k} \mid \psi \rangle$.
	As $\psi \in H^{s}(M;g)$ it follows that
	\begin{align}
		\| \psi \|^{2}_{\bar{s},2} = \sum_{k=0}^{\infty} \left| \hat{\psi}_{k} \right|^{2} (1+\lambda_{k})^{\bar{s}} < \infty.
		\label{eq:propapprox_eq1}
	\end{align}
	A corollary of Weyl's asymptotic formula is that $\lambda_{k}$ is $\mathcal{O}( k^{2/n})$ for large $k$ ~\cite[page 155]{Chavel1984}.
	After substitution of this asymptotic result into \eqref{eq:propapprox_eq1} for large $k$, we see that $|\hat{\psi}_{k}|^{2}$ is asymptotically dominated by  $C k^{-1- 2\bar{s}/n}$ for some constant $C$.
	For sufficiently large $N$ we find
	\begin{align*}
		\| \psi - \pi_{N}(\psi) \|_{s,2} = \sum_{k>N} (1+\lambda_{k})^{s} |\hat{\psi}_{k}|^{2} \leq C \sum_{k>N} (1+\lambda_{k})^{s} k^{-1- 2\bar{s}/n}
	\end{align*}
	and by another application of the Weyl formula
	\begin{align*}
		\| \psi - \pi_{N}(\psi) \|_{s,2} \leq \tilde{C} \sum_{k>N} \frac{1}{k^{1+2(\bar{s}-s)/n}} \leq C_{s,\bar{s}}  \frac{d }{ \bar{s}-s} N^{-2(\bar{s}-s)/n}.
	\end{align*}
	Where the last inequality is derived by bounding the infinite sum with an integral.
\end{proof}

%We should note that this error bound illustrates that we have a spectral convergence rate on smooth data.
%This rapid convergence for smooth data will cascade to bounds throughout this section.

With this error bound for the approximation error we can derive an error bound for Algorithm \ref{alg:half density}:

\begin{theorem} \label{thm:half density convergence}
	Let $\psi(0) \in H^{\bar{s}}(M)$ for $\bar{s} > s > 1$.
	Let $T > 0$ and $t \in [0,T]$.
	Let $\psi(t)$ be denote the solution to \eqref{eq:half density pde}
	with initial condition $\psi(0)$.
	Finally, let $\psi_{N}(t)$ be the output of Algorithm \ref{alg:half density}
	with respect to the inputs $\psi(0), t , N$ for some $N \in \mathbb{N}$.
	Then the error $\varepsilon_{N}(t) := \| \psi(t) - \psi_{N}(t) \|_{s,2}$ satisfies:
	\begin{align*}
		\varepsilon_{N}(t) \leq \| \psi(0) \|_{\bar{s},2} \, K_{T} \left( N^{-2(s-1)} t+  \frac{n}{\bar{s}-s} N^{-2(\bar{s}-s)/n} \right) e^{C_{T} t}
	\end{align*}
	where $K_{T}$ and $C_{T}$ are positive and constant with respect to $N$,$s$, and $\bar{s}$.
	In particular for $s = (\bar{s}+1)/2$:
	\begin{align*}
			\varepsilon_{N}(t) \leq \| \psi(0) \|_{\bar{s},2} \, K_{T} \left( N^{1-\bar{s}} t+  \frac{n}{\bar{s}-1} N^{(1-\bar{s})/n} \right) e^{C_{T} t}.
	\end{align*}
\end{theorem}

\noindent To prove Theorem \ref{thm:half density convergence}, we need a perturbed version of Gronwall's inequality:
\begin{lemma} \label{lem:Gronwall}
If $\frac{du}{dt} \leq Ku + \epsilon$ for some $K>0$ then $u(t) \leq (\epsilon t + u(0) ) e^{Kt}$.
\end{lemma}
\begin{proof}
	Let $w (t)= u (t) e^{-Kt}$.  Then for $t \geq 0$ we find
	\begin{align*}
		\frac{dw}{dt} = \frac{du}{dt} e^{-Kt} - K w \leq (Ku+\epsilon) e^{-Kt} - Kw = \epsilon e^{-Kt} \leq \epsilon
	\end{align*}
	Thus $w(t) \leq \epsilon t + w(0) = \epsilon t + u(0)$.
\end{proof}

Now we can prove Theorem \ref{thm:half density convergence}:

\begin{proof}[Proof of Theorem \ref{thm:half density convergence}]
	Note that $\frac{d\varepsilon_{N}}{dt} = \frac{1}{2\varepsilon_{N}} \langle  \psi - \tilde{\psi} \mid (1+\Delta)^{s} \frac{d}{dt} ( \psi -\tilde{\psi} )\rangle$
	By the Cauchy-Schwarz inequality
	\begin{align*}
		\frac{d\varepsilon_{N}}{dt} &\leq  \frac{1}{2} \| \pounds_{X}[\psi] - \pi_{N}(\pounds_{X}[\psi_{N}]) \|_{s,2} \\
		&= \frac{1}{2} \| \pounds_{X}[\psi] - \pi_{N}( \pounds_{X}[\psi- (\psi-\psi_{N})]) \|_{s,2}.
	\intertext{By the triangle inequality and the definition of the operator norm:}
		\frac{d\varepsilon_{N}}{dt}&\leq \| (1-\pi_{N}) \|_{H^{s-1},op} \, \|X \|_{H^{s},op} \, \| \psi \|_{s,2} + \| \pi_{N} \|_{op} \, \|X \|_{H^{s},op} \, \varepsilon_{N}
	\end{align*}
	From direct observation, we can verify that $\psi(t)$ is related to $\psi_{0}$ through the flow of $X$, $\Phi_X^t$
	via the equation
	\begin{align*}
		\psi(t,x) = \det( D[( \Phi_X^t)^{-1} ](x) ) \psi_0( (\Phi_X^t)^{-1}(x) )
	\end{align*}
	As $\Phi_X^t$ is smooth we can observe that $\| \psi(t) \|_{s,2}$ is bounded by a scalar multiple of $\| \psi_{0} \|_{s,2}$.
	Thus we may write the above bound in the form
	\begin{align*}
		\frac{d\varepsilon_{N}}{dt} \leq K' \, \| 1- \pi_{N} \|_{H^{s-1},op} \, \| \psi_{0}\|_{s,2}+ C_{T} \varepsilon_{N}
	\end{align*}
	for constants $C_{T}$ and $K'$.
	As $s > 1$, for sufficiently large $N$ we can compute that $\| 1-\pi_{N} \|_{H^{s-1},op} \leq (1+\lambda_{N+1})^{-(s-1)}$ where $\lambda_{N}$ denotes the $N$th eigenvalue of the Laplace operator.
	This is accomplished by observing the operator $1-\pi_{N}$ in a Fourier basis and applying to appropriate norms.
	By Weyl's asymptotic formula ~\cite[Theorem B.2]{Chavel1984}, $\lambda_{N}$ asymptotically behaves like $N^{2/n}$.
	Therefore by Lemma \ref{lem:Gronwall} with $\epsilon = C_{T} n^{-2(s-1) / d} \, \| \psi_{0}\|_{s,2}$:
	\begin{align*}
		\varepsilon_{N}(t) \leq ( K' N^{-2(s-1) / n} \| \psi_{0} \|_{s,2} t+  \varepsilon_{N}(0) ) e^{C_{T} t}.
	\end{align*}
	That $\varepsilon_{N}(0)$ behaves as $K'' \| \psi_{0} \|_{\bar{s},2} n^{-2(\bar{s}-s)/d}$ is a re-statement of Proposition \ref{prop:approximation}.
	We then set $K_{T} = \max(K', K'')$.
\end{proof}

Having derived an error bound for Algorithm \ref{alg:half density}, we can derive an error bound for Algorithm \ref{alg:density}.

\begin{theorem} \label{thm:density convergence}
	Let $\rho(0) \in W^{\bar{s},1}(M)$ for $\bar{s} > s >1$.
	Let $T > 0$ and $t \in [0,T]$ be fixed.
	Let $\rho(t)$ be the solution of \eqref{eq:density pde} at time $t$.
	Finally, let $\rho_{N}(t)$ be the output of Algorithm \ref{alg:density} with respect to the input $(\rho(0), t , N)$ for some $N \in \mathbb{N}$.
	Then:
	\begin{align*}
		\| \rho(t) - \rho_{N}(t) \|_{1} \leq \| \rho(0) \|_{\bar{s},1} \, K \left( N^{-2(s-1)} t+  \frac{d}{\bar{s}-s} N^{-2(\bar{s}-s)/n} \right) e^{C_{T} t}
	\end{align*}
	where $K$ is constant with respect to $N$, and $C_{T}$ is the same constant as in Theorem \ref{thm:half density convergence}.
\end{theorem}

\begin{proof}
	Without loss of generality, assume that $\rho$ is non-negative (otherwise split it into its non-negative and non-positive components).
	Let $\psi \in L^{2}(M)$ be such that $\rho =  \psi ^{2}$, as described in Algorithm \ref{alg:density}.
	It follows that $\psi \in H^{s}(M)$ and we compute
	\begin{align*}
		\| \rho(t) - \rho_{N}(t) \|_{1} = \int_{M} | \rho(t) - \rho_{N}(t)| dx = \int_{M} | \psi^{2} - \psi_{N}^{2} | dx
	\end{align*}
	If we let $\phi_{N} = \psi - \psi_{N}$ then we can re-write the above as
	\begin{align*}
		\| \rho(t) - \rho_{N}(t) \|_{1}  &= \int_{M} | \psi^{2} - (\psi - \phi_{N})^{2} | dx= \int_{M} | 2 \psi \phi_{N} - \phi_{N}^{2} | dx \\
			&\leq 2 \| \psi \|_{2} \| \phi_{N}\|_{2} + \| \phi_{N} \|_{2}^{2} = 2 \| \rho \|_{1}^{1/2} \cdot \| \phi_{N} \|_{2} + \| \phi_{N} \|_{2}^{2}
	\end{align*}
	Above we have applied Holder's inequality to $L^{2}(M)$, which still holds upon using the isometry generated by $\pounds_X$.
	Theorem \ref{thm:half density convergence} provides a bound for $\| \phi_{N} \|$.
	Substitution of this bound into the above inequality yields the theorem.
\end{proof}

Finally, we prove that Algorithm \ref{alg:function} converges to a solution of \eqref{eq:quantum observable ode}, which is equivalent to a solution of \eqref{eq:function pde} courtesy of Theorem \ref{thm:quantize}:

\begin{proposition} \label{prop:function approximation}
	Let $f \in C^{k}(M)$ and let $H_{f,N} = \pi_{N} \circ H_{f} \circ \pi_{N}$.  Then
	\begin{align*}
		\| H_{f} - H_{f,N} \|_{H^{s},op} \leq D \frac{n}{s} N^{-2s/n} \| \hat{f} \|_{op}
	\end{align*}
	where $s > k \geq 1$, and $D$ is constant.
\end{proposition}
\begin{proof}
	Let $\pi_{N}^{\perp} = 1 - \pi_{N}$.  By Proposition \ref{prop:approximation} we know that
	\begin{align}
		\| \pi_{N}^{\perp}(\psi) \|_{2} \leq \frac{n}{s} N^{-2s/n} \| \psi \|_{s,2} \label{eq:hot inequality}
	\end{align}
	for $s>0$, then:
	\begin{align*}
		\| H_{f} - H_{f,N} \|_{H^{s},op} &= \sup_{\| \psi \|_{s,2}=1} \langle \psi \mid H_{f} - H_{f,N} \mid \psi \rangle \\
			&= \sup_{\| \psi \|_{s,2}=1} \left( \langle \psi \mid H_{f}  \mid \psi \rangle - \langle \psi - \pi_{N}^{\perp}(\psi) \mid H_{f} \mid \psi - \pi_{N}^{\perp}(\psi) \rangle \right) \\
			&= \sup_{\| \psi \|_{s,2}=1} \left( 2 \Re \langle \pi_{N}^{\perp}(\psi) \mid H_{f} \mid \psi \rangle - \langle \pi_{N}^{\perp}(\psi) \mid H_{f} \mid \pi_{N}^{\perp}(\psi) \rangle \right) \\
			&\leq \sup_{\| \psi \|_{s,2}=1}  ( \| \pi_{N}^{\perp}(\psi) \|_{2}- \| \pi_{N}^{\perp}(\psi) \|_{2}^{2} ) \| H_{f} \|_{op} 
	\end{align*}
	By \eqref{eq:hot inequality} the result follows.
\end{proof}

\begin{theorem} \label{thm:function convergence}
	Let $T > 0$ and $t \in [0,T]$ be fixed.
	Let $f(t)$ denote the solution to \eqref{eq:function pde} at time $t$ with initial condition $f(0) \in C^{k}(M)$.
	Let $H_{f,N}(t)$ denote the output of Algorithm \ref{alg:function} with respect to the inputs $(f(0) , t  , N)$ for some $N \in \mathbb{N}$.
	Then:
	\begin{align*}
		\| H_{f(t)} - H_{f,N}(t) \|_{H^{s},op} &\leq D \frac{n}{s} N^{-2s/n} \| H_{f(t)} \|_{op} \\
			&\quad +  K_{T} \| H_{f,N}(t) \|_{op} \left( N^{1-s} + \frac{2n}{s -1} N^{(1-s)/n} \right) e^{C_{T}t}
	\end{align*}
	for the same constant $D$ as in Proposition \ref{prop:function approximation} and the same constants $C_{T},K_{T}$ as in Theorem \ref{thm:half density convergence}.
\end{theorem}

\begin{proof}
	We find
	\begin{align*}
		\| H_{f(t)} - H_{f,N}(t) \|_{H^{s},op} &= \sup_{\| \psi \|_{s,2} =1} \langle \psi \mid H_{f(t)} - H_{f,N}(t) \mid \psi \rangle
	\end{align*}
	In light of Proposition \ref{prop:isospectral} we find
	\begin{align*}
			\quad = \sup_{ \| \psi \|_{s,2} =1} \langle \psi \mid U(t) \cdot H_{f(0)} \cdot U(t)^{\dagger} - U_{N}(t) \cdot H_{f,N}(0) \cdot U_{N}(t)^{\dagger} \mid \psi \rangle.
	\end{align*}
	The output of Algorithm \ref{alg:function} indicates that $H_{f,N}(0) = \pi_{N}^{\perp} \circ H_{f(0)} \circ \pi_{N}^{\perp}$.
	Therefore, the above inline equation becomes
	\begin{align*}
			= \sup_{ \| \psi \|_{s,2} =1 } \langle U(t)^{\dagger} \psi \mid H_{f(0)} \mid U(t)^{\dagger} \psi \rangle
				- \langle U_{N}(t)^{\dagger} \psi \mid \pi_{N}^{\perp} \circ H_{f(0)} \circ \pi_{N}^{\perp} \mid U_{N}(t)^{\dagger} \psi \rangle.
	\end{align*}
	and finally
	\begin{align}
			&= \sup_{ \| \psi \|_{s,2} = 1} \langle U(t)^{\dagger} \psi \mid H_{f(0)} - H_{f,N}(0) \mid U(t)^{\dagger} \psi \rangle 
			- \langle  \phi(t) \mid H_{f,N}(0) \mid  \phi(t) \rangle \label{eq:final line}
	\end{align}
	where $\phi(t) = U_{N}(t)^{\dagger} \psi - U(t)^{\dagger} \psi$.
	
	The first term is bounded by Proposition \ref{prop:function approximation}.
	To bound the second term we must bound $\phi$.
	As $U_{N}(t)^{\dagger} \psi$ is the backwards time numerical solution to \eqref{eq:half density pde} and $U(t)^{\dagger}\psi$ is the exact backward time solution to \eqref{eq:half density pde},
	Theorem \ref{thm:half density convergence} prescribes the existence of constants $K$ and $C$ such that:
	\begin{align*}
		\| \phi \|_{\underline{s},2} = \| U_{N}(t)^{\dagger} \psi - U(t)^{\dagger} \psi \|_{\underline{s},2}  \leq K \| \psi \|_{s,2} \left(  N^{-2(\underline{s}-1)} + \frac{n}{s - \underline{s}} N^{-2(s-\underline{s})/n} \right) e^{Ct} 
	\end{align*}
	for any $\underline{s} <s$.
	This expression can be simplified by noting that $\| \psi \|_{s,2} = 1$, setting $\underline{s} = (1+s)/2$, and noting that the $H^{\underline{s}}$ norm is stronger than the $L^{2}$-norm to get:
	\begin{align*}
		 \| \phi \|_{2}  \leq  K \left(  N^{1-s} + \frac{2n}{s -1} N^{(1-s)/n} \right) e^{Ct}.
	\end{align*}
	By applying the Cauchy-Schwarz inequality to \eqref{eq:final line} and our derived bound on $\phi$:
	\begin{align*}
		\| H_{f(t)} - H_{f,N}(t) \|_{H^{s},op} &\leq \| H_{f(0)} - H_{f,N}(0) \|_{H^{s},op} \\
			&\quad+  K \| H_{f,N} \|_{op} \left( N^{1-s} + \frac{2n}{s -1} N^{(1-s)/n} \right) e^{Ct}
	\end{align*}
	Upon invoking Proposition \ref{prop:function approximation} we get the desired result.
%	\begin{align}
%		\| ( \hat{f}(t) - \hat{f}_{n}(t))|_{H^{s}} \|_{op} \leq D \frac{d}{s} n^{-2s/d} \| \hat{f} \|_{op}+  K \| \hat{f}_{n} \|_{op} \left( n^{1-s} + \frac{2d}{s -1} n^{(1-s)/d} \right) e^{Ct}
%	\end{align}
\end{proof}


\section{Qualitative Accuracy} \label{sec:qualitative}
In this section, we prove that our numerical schemes are qualitatively accurate.
We begin by illustrating the preservation of appropriate norms.
Throughout this section let $\psi_{N}(t)$, $\rho_{N}(t)$, and $H_{f,N}(t)$ denote the sequence of outputs of Algorithms \ref{alg:half density}, \ref{alg:density}, and \ref{alg:function} with respect to initial conditions $\psi(0) \in H^{s}(M;g), \rho(0) \in W^{s,1}$ and $f(0) \in C^{s}(M)$ for $N = 1,2,\dots$.
	
\begin{theorem} \label{thm:norms}
	Let $\psi,\rho,f$ denote solutions to \eqref{eq:half density pde}, \eqref{eq:density pde}, and \eqref{eq:function pde} respectively.
	Let $\psi_{N}(t),\rho_{N}(t)$, and $H_{f,N}(t)$, denote outputs from algorithms \ref{alg:half density}, \ref{alg:density}, and \ref{alg:function} respectively for a time $t < \infty$.
	Then $\| \psi_{N} (t)\|_{2}, \|\rho_{N}(t)\|_{1},$ and $\| H_{f,N}(t) \|_{op}$ are constant with respect to $t$ for arbitrary $N \in \mathbb{N}$.
	Moreover,
	\begin{align*}
		&\lim_{N \to \infty} \| \psi_{N} (t) \|_{2} = \| \psi(\cdot; t) \|_{2}, \\
		&\lim_{N \to \infty} \| \rho_{N}(t) \|_{nuc} = \| \rho(\cdot; t) \|_{1}, \\
		&\lim_{N \to \infty} \| H_{f,N}(t) \|_{op} = \| f( \cdot ;t) \|_{\sup}.
	\end{align*}
\end{theorem}
\begin{proof}
	To prove $\| H_{f,N} \|_{op}$ is conserved note that the evolution is isospectral ~\cite{Calvo1997}.
%	In particular, the solution is given by $\hat{f}_{n}(t) = U_{n}(t) \hat{f}_{n}(0) U_{n}(t)^{\dagger}$
%	where $U_{n}(t)$ is the the solution to $\dot{U}_{n} = X_{n} \cdot U_{n}$ with $U_{n}(0)$ as the identity.
%	As $U_{n}(t)$ is unitary, we can observe that 
%	\begin{align}
%		\| \hat{f}_{n}(t) \|_{op}  &= \sup_{\psi}( \langle \psi \mid \hat{f}_{n}(t) \mid \psi \rangle) = \sup_{\psi}\left( \langle \psi \mid U_{n}(t) \cdot \hat{f}_{n}(0) \cdot U_{n}(t)^{\dagger} \mid \psi \rangle \right) \\
%			&= \sup_{\psi} \left( \langle U_{n}(t)^{\dagger} \cdot \psi \mid \hat{f}_{n}(0) \mid U_{n}(t)^{\dagger} \psi \rangle \right) = \sup_{\psi} \langle \psi \mid \hat{f}_{n}(0) \mid \psi \rangle \\
%			&= \| \hat{f}_{n}(0) \|_{op}.
%	\end{align}
	We have already shown that $H_{f,N}(t)$ converges to $H_{f}(t)$ in the operator norm.
	Convergence of the norms follows from the fact that $\| H_{f}(t) \|_{op} = \| f \|_{\sup}$.
	An identical approach is able to prove the desired properties for $\rho_{N}(t)$ and $\psi_{N}(t)$ as well.
\end{proof}

Theorem \ref{thm:norms} is valuable because each of the norms is naturally associated to the entity which it bounds, and these quantities are conserved for the PDEs that this paper approximates.
For example, $\| H_{f} \|_{op} = \| f \|_{\sup}$ for a function $f$, and this is constant in time when $f$ is a solution to \eqref{eq:function pde}.
A discretization constructed according to Algorithm \ref{alg:function} according to Theorem \ref{thm:norms} is constant for any $N$, no matter how small.
%Similarly, since advection preserves the total mass of a density, $\rho$, \ram{citation} $\|\rho \|_{1}$ is conserved.
%Theorem \ref{thm:norms} proves that mass is conserved by discretizations generated by Algorithm \ref{alg:density}.

%Norms are merely the tip of the ice-berg in terms of conservation laws for advection.
The full Banach algebra $C(M)$ is conserved by advection too.
This property is encoded in our discretization as well.
\begin{theorem} \label{thm:algebra}
	Let $f(x;t),g(x;t)$, and $h(x;t)$ be solutions of \eqref{eq:function pde} and let $k= f \cdot g + h $.
	Let $H_{f,N}, H_{g,N}$ and $H_{h,N}$ be numerical solutions constructed by Algorithm \ref{alg:function}, then $H_{k,N}(t) = H_{f,N}\cdot H_{g,N}+H_{h,N}$
	satisfies
	\begin{align*}
		\frac{d}{dt} H_{k,N} = [ X_{N} , H_{k,N}].
	\end{align*}
	Moreover, $H_{k,N}(t)$ strongly converges to $H_{k}$ as $N \to \infty$ in the operator norm on $H^{s}(M)$ when $f,g,h \in C^{s}(M)$ for $s>1$.
\end{theorem}
\begin{proof}
	By construction, the output of Algorithm \ref{alg:function} is the result of an isospectral flow, and is therefore of the form 
	\begin{align*}
		&H_{f,N}(t) = U_{N}(t) H_{f,N}(0) U_{N}(t)^{\dagger} \\
		&H_{g,N}(t) = U_{N}(t) H_{g,N}(0) U_{N}(t)^{\dagger} \\
		&H_{h,N}(t) = U_{N}(t) H_{h,N}(0) U_{N}(t)^{\dagger}.
	\end{align*}
	We then observe
	\begin{align*}
		H_{k,N}(t) &= U_{N}(t) H_{k,N}(0) U_{N}(t)^{\dagger} = U(t)\left( H_{f,N}(0) H_{g,N}(0) + H_{h,N}(0) \right) U(t)^{\dagger} \\
			&= U(t)H_{f,N}(0) U(t)^{\dagger} U(t) H_{g,N}(0)U(t)^{\dagger} + U(t) H_{h,N}(0) U(t)^{\dagger} \\
			&=H_{f,N}(t)H_{g,N}(t) + H_{h,N}(t).
	\end{align*}
	Differentiation in time implies the desired result.
	Convergence follows from Theorem \ref{thm:function convergence}.
\end{proof}

Finally, the duality between functions and densities is preserved by advection.  If $f$ satisfies \eqref{eq:function pde} and $\rho $ satisfies \eqref{eq:density pde} then $\int f \rho$ is conserved in time.
Algorithms \ref{alg:density} and \ref{alg:function} satisfy this same equality:
\begin{theorem}
	For each $N \in \mathbb{N}$, $\Tr( H_{f,N} A_{\rho,N} (t))$ is constant in time where $A_{\rho,N} (t)= \psi_{N}(t) \otimes \psi_{N}(t)^{\dagger}$.
	Moreover, $\Tr( H_{f,N} A_{\rho,N} )$ converges to the constant $\int f\rho $ as $N \to \infty$.
\end{theorem}
\begin{proof}
	As $H_{f,N}(t) = U_{N}(t) H_{f,N}(0) U_{N}(t)^{\dagger}$ and $\psi_{N}(t) = U_{N} \cdot \psi_{N}(0)$ we observe that
	\begin{align*}
		&\Tr( H_{f,N}(t) (\psi_{N} (t) \otimes \psi_{N}^{\dagger} (t) ) ) \\
		&\quad = \Tr(  U_{N}(t) H_{f,N}(0) U_{N}(t)^{\dagger} U)_{N}(t) (\psi_{N}(0) \otimes \psi_{N}(0)^{\dagger}) U_{N}(t)^{\dagger}) \\
		&\quad = \Tr( H_{f,N}(0) ( \psi_{N}(0) \otimes \psi_{N}(0)^{\dagger} ) )
	\end{align*}
	Convergence follows from Theorems \ref{thm:function convergence} and \ref{thm:density convergence}.
\end{proof}


\section{Numerical Experiments} \label{sec:numerics}

This section describes two numerical experiments.  First, a benchmark computation to illustrate the spectral convergence of our method and the conservation properties in the case of a known solution is considered.

\subsection{Benchmark computation}
\label{sec:benchmark}
Consider the vector field $\dot{x} = -\sin(2 x)$ for $x \in S^{1}$.
The flow of this system is given by:
\begin{align*}
	\Phi_{X}^{t}(x) = \operatorname{atan} \left( e^{2t} \tan( x) \right).
\end{align*}
If the initial density is a uniform distribution, $\rho_{0}$, then the the exact solution of \eqref{eq:density pde} is:
\begin{align}
	\rho(x;t) =  \left( e^{2t} \sin^{2}(x) + e^{-2t} \cos^{2}(x) \right)^{-1}  \label{eq:exact solution}
\end{align}
Figure \ref{fig:S1} depicts the evolution of $\rho(x;t)$ at $t=1.5$ with an initial condition.
Figure \ref{fig:exact} depicts the exact solution, given by \eqref{eq:exact solution},  Figure \ref{fig:standard spectral} depicts the numerical solution computed from a standard Fourier discretization of \eqref{eq:density pde} with 32 modes, and Figure \ref{fig:gn spectral} depicts the numerical solution solution computed using Algorithm \ref{alg:density} with 32 modes.

\begin{figure}[h!]
	\hspace*{-.5cm}
	\begin{subfigure}{0.36\textwidth}
		\includegraphics[width=0.9\textwidth]{./images/exact_1D.pdf}
		\caption{Exact}
		\label{fig:exact}
	\end{subfigure}
	\hspace*{-.65cm}
	\begin{subfigure}{0.36\textwidth}
		\includegraphics[width=0.9\textwidth]{./images/standard_spectral_1D.pdf}
		\caption{Standard spectral}
		\label{fig:standard spectral}
	\end{subfigure}
	\hspace*{-.65cm}
	\begin{subfigure}{0.36\textwidth}
		\includegraphics[width=0.9\textwidth]{./images/gn_spectral_1D.pdf}
		\caption{Algorithm \ref{alg:density}}
		\label{fig:gn spectral}
	\end{subfigure}
	\caption{A benchmark illustration of Algorithm \ref{alg:density} on the example described in Section \ref{sec:benchmark}.}
	\label{fig:S1}
\end{figure}

Here we witness how Algorithm \ref{alg:density} has greater qualitative accuracy than a standard spectral discretization, in the ``soft'' sense of qualitative accuracy.
For example, standard spectral discretization exhibits negative mass, which is not achievable in the exact system.
Moreover, the $L^{1}$-norm is not conserved in standard spectral discretization.  
In contrast, Theorem \ref{thm:norms} proves that the $L^{1}$-norm is conserved by Algorithm \ref{alg:density}.
A plot of the $L^{1}$-norm is given in Figure \ref{fig:L1}.
Finally, a convergence plot is depicted in Figure \ref{fig:convergence}.  
Note the spectral convergence of Algorithm \ref{alg:density}.
In terms of numerical accuracy, Algorithm \ref{alg:density} appears to have a lower coefficient of convergence.

\begin{figure}[h!]
	\hspace*{-1.2cm}
	\centering
	\includegraphics[width=0.8\textwidth]{./images/L1_plot.pdf}
	\caption{A plot of the $L^{1}$-norm vs time of a standard spectral discretization (solid) and the result of Algorithm \ref{alg:density} (dotted) on the example described in Section \ref{sec:benchmark}.}
	\label{fig:L1}
\end{figure}

\begin{figure}[h!]
	\hspace*{-1.2cm}
	\centering
	\includegraphics[width=0.9\textwidth]{./images/convergence_plot.pdf}
	\caption{Convergence plot for Algorithm \ref{alg:density} (dotted) and a standard spectral method (solid) in the $L^{1}$-norm.}
	\label{fig:convergence}
\end{figure}

In general, Algorithm \ref{alg:function} is very difficult to work with, as it outputs an operator rather than a classical function.
However, Algorithm \ref{alg:function} is of theoretical value, in that it may inspire new ways of discretization (in particular, if one is only interested in a few level sets).
We do not investigate this potentiality here in the interest of focusing on the qualitative aspects of this discretization.
For example, under the initial conditions $g_{0}(x) = \cos(x)$ and $f_{0} = \sin(x)$ the exact solutions to \eqref{eq:quantum observable ode} are:
\begin{align*}
	g(x,t) &= \cos(x) \left( e^{4t} \sin^{2}(x) + \cos^{2}(x) \right)^{-1/2}\\
	f(x,t) &= \sin(x) \left( \sin^{2}(x) + e^{-4t} \cos^{2}(x) \right)^{-1/2}
\end{align*}
Under the initial condition $h_{0} = f_{0} \cdot g_{0}  = \sin(x) \cos(x)$ the exact solution to \eqref{eq:quantum observable ode} is:
\begin{align*}
	h(x,t) = f(x,t) g(x,t) = \cos(x) \sin(x) \left( \cos^{2}(x) + e^{4t} \sin^{2}(x) \right)^{-1}.
\end{align*}
One can compute $h$ by first multiplying the initial conditions and then using Algorithm \ref{alg:function} to evolve in time, or we may evolve each initial condition in time first, and multiply the outputs.
If one uses Algorithm \ref{alg:function}, then both options, as a result of Theorem \ref{thm:algebra}, yield the same result up to time discretization error (which is obtained with error tolerance $1e-8$ in our code).
In contrast, if one uses a standard spectral discretization, then these options yield different results with a discrepancy.
This discrepancy between the order of operations for both discretization methods is depicted in Figure \ref{fig:discrepancy}.

Finally, the sup-norm is preserved by the solution of \eqref{eq:function pde}.
As shown in Theorem \ref{thm:quantize}, the sup-norm is equivalent to the operator norm when the functions are represented as operators on $L^{2}(M)$.
As proven by Theorem \ref{thm:norms}, the operator-norm is conserved by Algorithm \ref{alg:function}.
In contrast, the sup-norm drifts over time under a standard discretization.  
This is depicted in Figure \ref{fig:norms}

\begin{figure}[h!]
	\hspace*{-1.2cm}
	\includegraphics[width=1.15\textwidth]{./images/function_plots/discrepancy}
	\caption{The discrepancy due to non-preservation of scalar products under a standard spectral Galerkin discretization. 
	The discrepancy of Algorithm \ref{alg:function} (not plotted) is attributable to our time-discretization scheme where we only tolerated error of $10^{-8}$ in this instance.}
	\label{fig:discrepancy}
\end{figure}  

\begin{figure}[h!]
	\hspace*{-1.2cm}
	\centering
	\includegraphics[width=0.8\textwidth]{./images/L_inf_plot.pdf}
	\caption{A plot of the sup-norm vs time of a standard spectral discretization (blue) and the result of Algorithm \ref{alg:function} (red) on the example described in Section \ref{sec:benchmark}.}
	\label{fig:norms}
\end{figure}

\subsection{A modified ABC flow}
\label{sec:ABC_flow}

Consider the system
\begin{align*}
	\dot{x} = A \sin( 2\pi z) + C \cos(2\pi y)  + D \cos(2\pi x)\\
	\dot{y} = B \sin( 2\pi z) + A \cos(2\pi y)  + D \cos(2\pi y)\\
	\dot{z} = A \sin( 2\pi z) + B \cos(2\pi y)  + D \cos(2\pi z)
\end{align*}
on the three-torus for constants $A,B,C,D \in \mathbb{R}$.  
When $D=0$ this system is the well studied volume conserving system known as an Arnold-Beltrami-Childress flow~\cite{ArnoldKhesin1992}.
When $A > B > C > 0$, $D=0$, and $C << 1$, then the solutions to this ODE are chaotic, with a uniform steady state distribution ~\cite{MajdaBertozzi2002}.
When $D=0$ the operator $\pounds_{X}$ of \eqref{eq:half density pde} is identical to the operator $\partial_{\alpha}( \rho X^{\alpha})$ that appears in \eqref{eq:density pde}, and Algorithm \ref{alg:half density} do not differ from a standard spectral discretization.
Therefore we consider the case where $D > 0$ to see how our discretization are differs from the standard one.
When $D> 0$ volume is no longer conserved and there is a non-uniform steady-state distribution.

For the following numerical experiment let $A=1.0,B=0.5,C=0.2,$ and $D=0.5$.
As an initial condition consider a wrapped Gaussian distribution with anisotropic variance $\sigma= (0.2, 0.3, 0.3)$ centered at $(0,0,0)$.
Equation \eqref{eq:density pde} is approximately solved using Algorithm \ref{alg:density}, Monte-Carlo, and a standard spectral method.
The results of the $z$-marginal of these densities are illustrated in Figure \ref{fig:ABCD}.
The top row depicts the results from using Algorithm \ref{alg:density} using $33$ modes along each dimension.
The middle row depicts the results from using a Monte-Carlo method with $15^{3} = 3375$ particles as a benchmark computation.
Finally, the bottom row depicts the results from using a standard Fourier based discretization of \eqref{eq:density pde} using 33 modes along each dimension.
Notice that Algorithm \ref{alg:density} performs well when compared to the standard discretization approach.

\begin{figure}[h!]
	\centering
	\includegraphics[width=1\textwidth]{./images/ABCD_flow.png}
	\caption{An illustration of the performance of Algorithm \ref{alg:density} (top row), Monte Carlo (middle row) and a standard spectral Galerkin (bottom row) on the example described in Section \ref{sec:ABC_flow}.
	The domain is the $2$-torus.  Here we've consider an initial probability density given by a wrapped Gaussian. Darker regions represent areas of higher-density.}
	\label{fig:ABCD}
\end{figure}


\section{Conclusion}

In this paper we constructed a numerical scheme for \eqref{eq:function pde} and \eqref{eq:density pde} that is spectrally convergent and qualitatively accurate, in the sense that natural invariants are preserved.
The result of obeying such conservation laws is a robustly well-behaved numerical scheme at a variety of resolutions where legacy spectral methods fail.
This claim was verified in a series of numerical experiments which directly compared our algorithms with standard Fourier spectral algorithms.
The importance of these conservation laws was addressed in a short discussion on the Gelfand Transform.
We found that conservation laws completely characterize \eqref{eq:function pde} and \eqref{eq:density pde}, and this explains the benefits of using qualitatively accurate scheme at a more fundamental level.


\subsection{Acknowledgements}
This paper developed over the course of years from discussions with many people whom we would like to thank: Jaap Eldering, Gary Froyland,
 	Darryl Holm, Peter Koltai, Stephen Marsland, Igor Mezic, Peter Michor, Dmitry Pavlov, Tilak Ratnanather, and Stefan Sommer. 
This research was made possible by funding from the University of Michigan.


\bibliographystyle{siamplain}

\begin{thebibliography}{10}

\bibitem{ArnoldKhesin1992}
{\sc V.~I. Arnold and B.~A. Khesin}, {\em Topological Methods in
  Hydrodynamics}, vol.~24 of Applied Mathematical Sciences, Springer Verlag,
  1992.

\bibitem{Balci2011}
{\sc N.~Balci, B.~Thomases, M.~Renardy, and C.~R. Doering}, {\em Symmetric
  factorization of the conformation tensor in viscoelastic fluid models},
  Journal of Non-Newtonian Fluid Mechanics, 166 (2011), pp.~546--553.

\bibitem{BatesWeinstein1997}
{\sc S.~Bates and A.~Weinstein}, {\em Lectures on the geometry of
  quantization}, vol.~8 of Berkeley Mathematics Lecture Notes, American
  Mathematical Society, Providence, RI, 1997.

\bibitem{BittracherKoltaiJunge2015}
{\sc A.~Bittracher, P.~Koltai, and O.~Junge}, {\em Pseudogenerators of spatial
  transfer operators}, SIAM Journal on Applied Dynamical Systems, 14 (2015),
  pp.~1478--1517.

\bibitem{VODE}
{\sc P.~N. Brown, G.~D. Byrne, and A.~C. Hindmarsh}, {\em V{ODE}: a
  variable-coefficient {ODE} solver}, SIAM Journal on Scientific and Statistical Computing, 10 (1989),
  pp.~1038--1051.

\bibitem{BudisicMohrMezic2012}
{\sc M.~Budi{\v s}i{\'c}, R.~Mohr, and I.~Mezi{\'c}}, {\em Applied Koopmanism},
  Chaos: An Interdisciplinary Journal of Nonlinear Science, 22 (2012).

\bibitem{Calvo1997}
{\sc M.~Calvo, A.~Iserles, and A.~Zanna}, {\em Numerical solution of
  isospectral flows}, Mathematics of Computation of the American Mathematical
  Society, 66 (1997), pp.~1461--1486.

\bibitem{Chavel1984}
{\sc I.~Chavel}, {\em Eigenvalues in {R}iemannian geometry}, vol.~115 of Pure
  and Applied Mathematics, Academic Press, Inc., Orlando, FL, 1984.

\bibitem{Conway1990}
{\sc J.~B. Conway}, {\em A course in functional analysis}, vol.~96 of Graduate
  Texts in Mathematics, Springer-Verlag, New York, second~ed., 1990.

\bibitem{Crane2013}
{\sc K.~Crane, U.~Pinkall, and P.~Schr\"{o}der}, {\em Robust fairing via
  conformal curvature flow}, ACM Transactions on Graphics, 32 (2013).

\bibitem{Evans2010}
{\sc L.~C. Evans}, {\em Partial differential equations}, vol.~19 of Graduate
  Studies in Mathematics, American Mathematical Society, Providence, RI,
  second~ed., 2010.

\bibitem{FroylandJungeKoltai2013}
{\sc G.~Froyland, O.~Junge, and P.~Koltai}, {\em Estimating long-term behavior
  of flows without trajectory integration: the infinitesimal generator
  approach}, SIAM J. Numer. Anal., 51 (2013), pp.~223--247.

\bibitem{FroylandPadberg2009}
{\sc G.~Froyland and K.~Padberg}, {\em Almost-invariant sets and invariant
  manifolds---connecting probabilistic and geometric descriptions of coherent
  structures in flows}, Phys. D, 238 (2009), pp.~1507--1523.

\bibitem{GelfandNaimark1943}
{\sc I.~Gelfand and M.~Neumark}, {\em On the imbedding of normed rings into the
  ring of operators in {H}ilbert space}, Rec. Math. [Mat. Sbornik] N.S., 12(54)
  (1943), pp.~197--213.

\bibitem{Gottlieb2001}
{\sc D.~Gottlieb and J.~Hesthaven}, {\em Spectral methods for hyperbolic
  problems}, Journal of Computational and Applied Mathematics, 128 (2001),
  pp.~83 -- 131.
%\newblock Numerical Analysis 2000. Vol. VII: Partial Differential Equations.

\bibitem{Gottlieb1977numerical}
{\sc D.~Gottlieb and S.~A. Orszag}, {\em Numerical analysis of spectral
  methods: theory and applications}, vol.~26, SIAM, 1977.

\bibitem{Bondia2001}
{\sc J.~M. Gracia-Bond{\'{\i}}a, J.~C. V{\'a}rilly, and H.~Figueroa}, {\em
  Elements of noncommutative geometry}, Birkh\"auser Advanced Texts: Basler
  Lehrb\"ucher. [Birkh\"auser Advanced Texts: Basel Textbooks], Birkh\"auser
  Boston, Inc., Boston, MA, 2001.

\bibitem{GuilleminSternberg1970}
{\sc V.~Guillemin and S.~Sternberg}, {\em Geometric Asymptotics}, vol.~14 of
  Mathematical Surveys and Monographs, American Mathematical Society, 1970.

\bibitem{Hebey1999}
{\sc E.~Hebey}, {\em Nonlinear analysis on manifolds: {S}obolev spaces and
  inequalities}, vol.~5 of Courant Lecture Notes in Mathematics, New York
  University, Courant Institute of Mathematical Sciences, New York; American
  Mathematical Society, Providence, RI, 1999.

\bibitem{HenrionKorda2014}
{\sc D.~Henrion and M.~Korda}, {\em Convex computation of the region of
  attraction of polynomial control systems}, IEEE Transactions on Automatic
  Control, 59 (2014), pp.~297--312.

%\bibitem{MO_dense_charts}
%{\sc R.~M. (http://mathoverflow.net/users/2906/richard montgomery)}, {\em Does
%  every compact manifold exhibit an almost global chart}.
%\newblock MathOverflow, \url{http://mathoverflow.net/q/177913},
%  \href{http://arxiv.org/abs/http://mathoverflow.net/q/177913}{arXiv:http://mathoverflow.net/q/177913}.
%\newblock URL:http://mathoverflow.net/q/177913 (version: 2014-08-06).

\bibitem{Ismagilov1975}
{\sc R.~S. Ismagilov}, {\em The unitary representations of the group of
  diffeomorphisms of the space {$R^{n},$} {$n\geq 2$}}, Functional Analysis and its applications,
  9(2) (1975), pp.~154--155.

\bibitem{koltai2011thesis}
{\sc P.~Koltai}, {\em Efficient approximation methods for the global long-term
  behavior of dynamical systems: theory, algorithms and examples}, Logos Verlag
  Berlin GmbH, 2011.

\bibitem{LasotaMackey1994}
{\sc A.~Lasota and M.~C. Mackey}, {\em Chaos, Fractals, and Noise}, Applied
  Mathematical Sciences, Springer Verlag, 1994.

\bibitem{Lee2006}
{\sc J.~M. Lee}, {\em Introduction to smooth manifolds}, vol.~218 of Graduate
  Texts in Mathematics, Springer-Verlag, 2nd~ed., 2006.

\bibitem{Leveque1992}
{\sc R.~J. LeVeque}, {\em Numerical methods for conservation laws}, Lectures in
  Mathematics ETH Z\"urich, Birkh\"auser Verlag, Basel, second~ed., 1992.

\bibitem{MajdaBertozzi2002}
{\sc A.~J. Majda and A.~L. Bertozzi}, {\em Vorticity and incompressible flow},
  vol.~27 of Cambridge Texts in Applied Mathematics, Cambridge University
  Press, Cambridge, 2002.

\bibitem{Meyer1998}
{\sc P.~A. Meyer}, {\em Quantum probability for probabilists}, vol.~1538 of
  Lecture Notes in Mathematics, Springer-Verlag, Berlin, 1993.

\bibitem{Mezic2005}
{\sc I.~Mezi{\'c}}, {\em Spectral properties of dynamical systems, model
  reduction and decompositions}, Nonlinear Dynamics, 41 (2005), pp.~309--325.

\bibitem{Pasciak1980}
{\sc J.~E. Pasciak}, {\em Spectral and pseudospectral methods for advection
  equations}, Mathematics of Computation, 35 (1980), pp.~1081--1092.

\bibitem{Rowley2009}
{\sc C.~W. Rowley, I.~Mezi{\'c}, S.~Bagheri, P.~Schlatter, and D.~S.
  Henningson}, {\em Spectral analysis of nonlinear flows}, Journal of Fluid
  Mechanics, 641 (2009), pp.~115--127.

\bibitem{Sakai1996}
{\sc T.~Sakai}, {\em Riemannian geometry}, vol.~149 of Translations of
  Mathematical Monographs, American Mathematical Society, Providence, RI, 1996.

\bibitem{Schmid2010}
{\sc P.~J. Schmid}, {\em Dynamic mode decomposition of numerical and
  experimental data}, Journal of Fluid Mechanics, 656 (2010), pp.~5--28.

\bibitem{Taylor1974}
{\sc M.~Taylor}, {\em Pseudo differential operators}, Lecture Notes in
  Mathematics, Vol. 416, Springer-Verlag, Berlin-New York, 1974.

\bibitem{Truesdell1991}
{\sc C.~Truesdell}, {\em A First Course in Rational Continuum Mechanics:
  General Concepts}, Academic Press, 1991.

\bibitem{Ulam1947}
{\sc S.~M. Ulam and J.~Von~Neumann}, {\em On combination of stochastic and
  deterministic processes-preliminary report}, Bulletin of the American
  Mathematical Society, 53 (1947), pp.~1120--1120.

\bibitem{VershilGelfandGraev1975}
{\sc A.~M. Vershik, I.~M. Gelfand, and M.~I. Graev}, {\em Representations of
  the group of diffeomorphisms}, Uspehi Mat. Nauk, 30 (1975), pp.~1--50.

\end{thebibliography}

\end{document}
