\documentclass[12pt]{amsart}
\usepackage{amsmath,amssymb}
\usepackage{geometry} % see geometry.pdf on how to lay out the page. There's lots.
\geometry{a4paper} % or letter or a5paper or ... etc
% \geometry{landscape} % rotated page geometry

%  POSSIBLY USEFULE PACKAGES
%\usepackage{graphicx}
\usepackage{tensor}
\usepackage{todonotes}
\usepackage{xypic}

%  NEW COMMANDS
\newcommand{\pder}[2]{\ensuremath{\frac{ \partial #1}{\partial #2}}}
\newcommand{\ppder}[3]{\ensuremath{\frac{\partial^2 #1}{\partial
      #2 \partial #3} } }
\newcommand{\R}{\ensuremath{\mathbb{R}}}
\renewcommand{\H}{\ensuremath{\mathcal{H}}}
\newcommand{\norm}[1]{\ensuremath{\left\| #1 \right\| }}
\newcommand{\abs}[1]{\ensuremath{ | #1 | }}

%  NEW THEOREM ENVIRONMENTS
\newtheorem{thm}{Theorem}[section]
\newtheorem{prop}[thm]{Proposition}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{defn}[thm]{Definition}

% NEW ENVIRONMENTS
\newenvironment{example}
  { \newline {\bf Example:} }
  {\rule{1ex}{1ex} }

%  MATH OPERATORS
\DeclareMathOperator{\Diff}{Diff}
\DeclareMathOperator{\Dens}{Dens}
\DeclareMathOperator{\SO}{SO}
\DeclareMathOperator{\U}{U}
\DeclareMathOperator{\B}{B}
\DeclareMathOperator{\Fr}{Fr}
\DeclareMathOperator{\Herm}{Herm}
\DeclareMathOperator{\Op}{Op}
\DeclareMathOperator{\Tr}{Tr}
\DeclareMathOperator{\card}{card}
\DeclareMathOperator{\Con}{Con}

%  TITLE, AUTHOR, DATE
\title{Qualitatively accurate spectral schemes for advection equations}
\author{Henry O. Jacobs \& Ram Vasudevan}
\date{\today}


\begin{document}

\maketitle

\begin{abstract}
  blah blah blah.
\end{abstract}
\todo[inline]{We should put a successful numerical example of our scheme towards the beginning}

\section{Introduction}
\label{sec:PDEs}
Let $X$ be a vector-field on a compact manifold $M$ of dimension $d$
and the evolution PDEs given in a local coordinate chart by
\begin{align}
	&\partial_t f + X^k \partial_k f= 0 \label{eq:function_pde} \\
	&\partial_t \rho + \partial_k( X^k \rho) = 0  \label{eq:density_pde} \\
	&\partial_t Y^i - (\partial_k X^i) \cdot Y^k + (\partial_k Y^i) X^k  = 0 \quad , \quad i = 1,\dots,d \label{eq:vf_pde}.
\end{align}
Each of these equations can be described as an advection equation in the sense that
\begin{itemize}
	\item a solution to \eqref{eq:function_pde} is given by a time-dependent function evolving under the dynamics generated by $X$,
	\item a solution to \eqref{eq:density_pde} is given by a time-dependent density evolving under the dynamics generated by $X$,
	\item and a solution to \eqref{eq:vf_pde} is given by a time-dependent vector-field evolving under the dynamics generated by $X$.
\end{itemize}
In summary, these PDEs can each be written in coordinate free notation as
\begin{align}
	\partial_t \alpha + \pounds_{X}[\alpha] = 0 \label{eq:advection_pde}
\end{align}
where $\alpha$ is a field and $\pounds_X[\alpha]$ is the Lie-derivative of $\alpha$ under the action of $X$.
The solution to \eqref{eq:advection_pde} (and therefore the solution to \eqref{eq:function_pde},\eqref{eq:density_pde}, and \eqref{eq:vf_pde}) is always of the form of a push-forward, $(\Phi_{X}^t)_* (\alpha_0)$, where $\Phi_{X}^t : M \to M$ is the flow at time $t \in \R$ induced by $X$ and $\alpha_0$ is the initial condition.
That is to say, the solutions are
\begi

\subsection{Conservation properties of advection}
The advection of fields is a special type of evolution where the inter-relationships between the fields are conserved.
For example, if $f$ and $g$ are time-dependent functions which satisfy \eqref{eq:function_pde} then the functions $f+g$ and $fg$
obtained by point-wise addition and multiplication will satisfy \eqref{eq:function_pde} as well.
In summary, the evolution induced by \eqref{eq:function_pde} is that of a time-dependent ring-morphism.

Another conserved structure is the relationship between functions and densities.  Given a function $f$ and a density $\rho$
one can form the real-number $\langle f, \rho \rangle$ obtained by integrating the density $f \rho$.
If $f$ and $\rho$ are solutions to \eqref{eq:function_pde} and \eqref{eq:density_pde} respectively, then $\langle f , \rho \rangle$ is constant in time.

Finally, if $Y_t$ is a solution to \eqref{eq:vf_pde} and $f_t$ is a solution to \eqref{eq:function_pde} then $\pounds_{Y_t}[f_t]$ is a solution to \eqref{eq:function_pde} too.
If $\rho_t$ is a solution to \eqref{eq:density_pde} then $\pounds_{Y_t}[ \rho_t]$ is a solution to \eqref{eq:density_pde} too.
If $Z_t$ is a solution to \eqref{eq:vf_pde} then $[Y_t,Z_t]$ is a solution to \eqref{eq:vf_pde} too.

These examples only touch the surface of all the conservation of advection when one advects multiple entities by the same vector-field.

\subsection{The purpose of this article}
\label{sec:purpose}
If one separately discretizes \eqref{eq:function_pde} \eqref{eq:density_pde} and \eqref{eq:vf_pde} using a legacy method
then, generally speaking, the resulting solutions will not satisfy the conservation properties just mentioned in any reasonable sense.
For example, if $M$ is the $2$-torus and we discretize \eqref{eq:function_pde} with a finite difference scheme on a uniform grid,
then functions are finitely represented by their values at each grid point.
However, the evolution of the finite-difference scheme will not be that of a ring-morphism.
Moreover, if one uses the same finite-difference scheme to discretize \eqref{eq:density_pde}, the dual-pairing between the 
``discretized functions'' and the ``discretized densities'' will generally not be preserved.
The same holds for the other conservation properties mentioned.

Admittedly, it is a simple matter to work some of these properties into a discretization scheme,
but usually in isolation!
For example, one could spectrally discretized the linear operator  $\partial_k (X^k \cdot )$ appearing in \eqref{eq:density_pde} by the transpose of
a spectral discretization of the operator $X^k \partial_k$ appearing in \eqref{eq:function_pde}.
This discretization would ensure that the dual-pairing between discrete functions and discrete densities is preserved.
However, such a discretization would not produce ring-morphisms and it not clear how to incorporate this
property without breaking the recently achieved dual-pairing conservation property.
In summary, it does not seem obvious how to incorporate all of these properties simultaneously.

Of course, at high resolution any convergent method will approximately satisfy the conservation laws.
This high resolution assumption does not always hold.
In the case of high dimensional systems, one must use schemes which are accurate at low resolutions.
The purpose of this article is to introduce a spectral discretization of \eqref{eq:function_pde},\eqref{eq:density_pde}, and \eqref{eq:vf_pde}
which preserves discretized notions of many geometric conservation properties at arbitrarily low resolutions.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Geometric Lebesgue spaces}
\label{sec:densities}
In this section we define a geometric version of Lebesgue spaces.
Let $M$ be a smooth compact $n$-manifold
and we will let $L^1(M)$ denote the space of densities
which we view as multi-linear functions on $\bigoplus^n TM$ \cite[Chapter 16]{Lee2006}.

\begin{defn}\label{def:p-density}
	Given $0 < \alpha \leq 1$, an $\alpha$-density is a continuous function $\nu : \bigoplus^n TM \to \mathbb{C}$
	such that $\nu^{p} \in L^1(M)$.
	By continuous extension, we will identify a $0$-density as a continuous functions on $M$.
	We denote the space of $\alpha$ densities by $\Dens^{\alpha}(M)$.
\end{defn}

This definition is an equivalent reformulation of the $\alpha$-densities defined in the context of geometric quantization \cite{GuilleminSternberg1970,BatesWeinstein1997}.
The following proposition follows by inspection.
\begin{prop}
	If $1 \leq p < \infty$ then $\Dens^{1/p}(M)$ is a normed vector-space with $\| \nu \|_p := \int_M |\nu|^p$ for $1 \leq p < \infty$.
\end{prop}
%\begin{proof}
%	It is clear that $\Dens^p(M)$ is a vector-space.
%	We need only show that $\| \cdot \|_p$ satisfies the properties of a norm.
%	Firstly, one can observe directly that $\| \nu \|_p > 0$ for any $\nu \neq 0$.
%	Secondly,
%\end{proof}

\begin{defn}
	For $1 \leq p < \infty$ we let $L^p(M)$ denote the completion of $\Dens^{1/p}(M)$ under the $p$-norm.
	We let $L^\infty(M)$ denote the space of essentially bounded complex valued functions on $M$
	equipped with the norm $\| f \|_\infty = {\rm esssup}(|f|)$.
\end{defn}

As Banach spaces, $L^p(M)$ is isomorphic to the standard $L^p$-function space on $M$.
This point will be made explicit in the following subsection.
Moreover, given $\mu \in L^p(M)$ and $\nu \in L^q(M)$ the function $\mu \cdot \nu : \bigoplus^n TM \to \mathbb{C}$ is
contained in $L^{p+q}(M)$.
However, by defining the basic elements as $p$-densities rather than functions on $M$, a few critical distinctions arise.
Firstly, the notion of $L^p(M)$ as a canonically embedded subspace of $L^q(M)$ when $p > q$ is nonsense because $\Dens^p(M)$ is not a subspace of $\Dens^q(M)$. 
Secondly, the transformation law is that of $p$-densities, not of functions.
In particular, given a diffeomorphism $\Phi \in \Diff(M)$
there is a natural transformation of a $p$-densities given by
\begin{align}
	\Phi^*\nu(e_1,\dots,e_n) = \nu( D\phi \cdot e_1 , \dots, D\Phi \cdot e_n). \label{eq:transformation_law}
\end{align}
Only when $p = \infty$ will the above transformation law match that of a function on $M$.
Thus only $L^\infty(M)$ is the completion of a space of functions on $M$.
Note that the transformation \eqref{eq:transformation_law} preserves the $p$-norm of $\nu$.
Thus the map $\nu \mapsto \Phi^* \nu$ is continuous on $L^p(M)$.

We end this section by singling out three particularly important $L^p$ spaces.
In particular, the space $L^\infty(M)$ is a $C^*$-algebra under the operations of addition multiplication and complex conjugation for complex functions on $M$.
	The space $L^1(M)$ is the pre-dual to $L^{\infty}(M)$.
	Finally, $L^2(M)$ is a Hilbert space with inner-product
	\begin{align*}
		\langle \psi_1 \mid \psi_2 \rangle := \int_M \overline{\psi_1} \cdot \psi_2.
	\end{align*}
	For notational convenience, given a (possibly unbounded) linear operator $L: L^2(M) \to L^2(M)$
	\begin{align*}
		\langle \psi_1 \mid L \mid \psi_2 \rangle := \int_M \overline{\psi_1} \cdot L(\psi_2).
	\end{align*}

\subsection{The relationship with classical Lebesgue spaces}
\label{sec:classical_Lebesgue}
For any manifold $M$ (possibly non-orientable) one can assert the existence of a smooth non-negative density $\mu$ \todo{cite the appropriate theorem in Lie}.
The choice of a non-vanishing density is unique only up to multiplication by a non-vanishing function.
In any case, upon choosing $\mu$ the $p$-norm on a bounded function $f$ is defined as
\begin{align*}
	\| f \|_p =  \left( \int_M f(x)^p |\mu| \right)^{1/p}.
\end{align*}
and $L^p(M ; \mu)$ is the completion of this function space.

\begin{prop}
	For any $\nu \in L^p(M)$ there exists a unique $f \in L^p(M ; \mu)$ such that $\nu = f \cdot |\mu|^{1/p}$.
	This yields a continuous isomorphism between $L^p(M)$ and $L^p(M ; \mu)$.
\end{prop}
\begin{proof}
	First note that if we view $\mu$ as a positive function on $\bigoplus^n TM$, then $\mu^{1/p}$ is a $\frac{1}{p}$-density.
	It suffices to prove the dense subspace $\Dens^{1/p}$ is isomorphic to $C^0(M)$ through a map that preserves the $p$-norm
	because $C^0(M)$ is dense in $L^p(M ; \mu)$ and $\Dens^{1/p}(M)$ is dense in $L^p(M)$.
	
	Let $\nu \in \Dens^{1/p}(M)$.  Then $\nu^p$ is a continuous density.
	The Radon-Nikodym derivative of $\nu^p$ with respect to $\mu$ is a positive valued continuous function $f \in C^0(M)$ such that $f \, \mu = \nu^p$.
	It then follows that $\nu = f^{1/p} \, \mu^{1/p}$.
	Moreover, the map $\nu \in \Dens^{1/p}(M) \mapsto f^{1/p} \in C^0(M)$ preserves the $p$-norm, and so is continuous.
	The inverse of the map is clearly given by $f^{1/p} \mapsto f^{1/p} \cdot \mu^{1/p}$.
\end{proof}

\subsection{Sobolev spaces on Riemannian manifolds}
\label{sec:Sobolev spaces}
Let $M$ be a Riemannian $n$-manifold with metric $g:TM \oplus TM \to \mathbb{R}$.
The metric induces a positive density $\mu_g$,
known as the \emph{metric density},
as well as an elliptic operator,
$\Delta:C^\infty(M) \to C^{\infty}(M)$,
known as the \emph{Laplace-Beltrami operator}. 
The Riemmanian density induces the $L^2$ inner-product on $C^\infty(M)$ via
\begin{align*}
	\langle f_1 , f_1 \rangle_{g} = \int \overline{f_1} \cdot f_2 \mu_g
\end{align*}
and $\Delta$ is positive-semidefinite.
If $M$ is compact, then $L^2(M ; \mu_g) \cong L^2(M)$ is a separable Hilbert space
and the Helmholtz operator, $1 + \Delta$, is then a positive definite operator
with a discrete spectrum.
For any $s \geq 0$ we may define the Sobolev norm
\begin{align*}
	\| f \|_{s,2} =  \left( \langle f , (1+\Delta)^s \cdot f \rangle_{g} \right)^{1/2}
\end{align*}
and $H^s(M ; g)$ is then the function space obtained by completion with respect to this norm, and modulo discrepancies of measure zero.
Note that $H^0(M;g) = L^2(M;\mu_g)$.

The following proposition will be of use later when we need to prove a notion of convergence
via sequences of finite rank operators.

\begin{prop} \label{prop:compact_embedding}
	Let $(M,g)$ be a compact Riemmanian manifold.  If $s > t \geq 0$ then $H^s(M;g)$ is compactly embedded within $H^t(M,g)$.
\end{prop}
\begin{proof}
	Let $e_0, e_1,\dots$ be a Hilbert basis for $L^2(M;\mu_g)$ which diagonalizes $\Delta$
	in the sense that $\Delta e_i = \lambda_i e_i$ for a sequence $0 = \lambda_0 \leq \lambda_1 \leq \lambda_2 \leq \cdots$.
	The operator $(1+\Delta)^s$ is given by
	\begin{align*}
		(1+\Delta)^s \cdot f =  \sum_{i} e_i (1+\lambda_i)^s \langle e_i , f \rangle_g,
	\end{align*}
	and so $\{ (1+ \lambda_i)^{-s/2} e_i \}_{i=1}^{\infty}$ is a Hilbert basis for $H^s(M;g)$.
	
	Let us call $e_i^{(s)} = (1+ \lambda_i)^{-s/2} e_i$.
	The embedding of $H^s(M;g)$ into $H^t(M,g)$
	is then given in terms of the respective basis elements by $e_i^{(s)} \mapsto (1+\lambda_i)^{-(s-t)/2}e_i^{(t)}$.
	As $s > t$ and $\lambda_i \to +\infty$, we see that 
	this embedding is a compact operator \cite[see Proposition 4.6]{Conway1990}.
\end{proof}

In the sequel we shall say that a wave-function $\psi \in L^2(M)$ is of class $H^s$ if there exists
a metric $g$ such that $\psi = f \sqrt{\mu_g}$, and $f \in H^s(M,g)$.\footnote{Perhaps any two Riemannian metrics on $M$
would yield the same Hilbert space $H^s(M,g)$.
If so, it would be reasonable to define a space $H^s(M)$ as a subspace of $L^2(M)$ defined independently of a metric.
We were not able to prove this statement for fractional $s$, nor were we able to find a source.
However, it is known to be true for the case where $s$ is a positive integer.} 

%We would like to represent these Sobolev spaces as existing independent of the metric
%just as the Lebesgue spaces can be expressed.
%If $M$ is a smooth compact manifold and $g^0$ and $g^1$ are two metrics on $M$,
%then we can show that $H^s(M;g^0)$ and $H^s(M,g^1)$ are isometrically isomorphic.
%In particular, $f \in H^s(M;g^0)$ if and only if $|(1+\Delta_{g^0})^{s/2}f|^2 \in L^1( M , \mu_{g^0})$ a
%However, $\mu_0$ and $\mu_1$ are both smooth positive densities.
%Thus $\mu_0  = h \mu_1$ for some smooth function $h$, which is bounded because $M$ is compact.
%Thus $h \in L^\infty(M)$ and by Holder's inequality, $|(1+\Delta)^{s/2}f|^2 \cdot h \in L^1(M , \mu_{g^0})$.
%This is equivalent to stating that $|(1+\Delta)^{s/2}f|^2 \in L^1(M,\mu_{g^1})$ which in turn means
%$f \in H^s(M, \mu_{g^1})$.
%
%\todo[inline]{You forgot to transform the Laplace-Beltrami operator.,}
%Additionally, we may use the isomorphism between $L^2(M)$ and $L^2(M;\mu_g)$ to make a metric-independent definition.
%Let $H^s(M) = \{ \psi \in L^2(M) \mid \psi = f \sqrt{\mu_g} , f \in H^s(M;g) \}$ for an arbitrary metric $g$ on $M$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Advection on manifolds}
\label{sec:classical}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
By virtue of being a manifold, $M$ is canonically equipped with the following structures:
\begin{enumerate}
	\item The topological group of smooth diffeomorphisms, $(\Diff(M), \circ)$.
	\item The $C^*$-algebra $L^\infty(M)$.
	\item The Lie algebra of smooth vector-fields, $(\mathfrak{X}(M) , [ \cdot , \cdot ])$.
	\item The space $L^1(M)$, pre-dual to $L^\infty(M)$.
	\item The cone $L^\infty(M;\R^+)$ and the pre-dual cone $L^1(M;\R^+)$
	which contains the space of probability distributions.
	\item The Hilbert space $(L^2(M), \langle \cdot \mid \cdot \rangle)$.
\end{enumerate}
Each of these entities is linked to the others in a network of relationships
which we shall review here.
For starters, for any $\Phi \in \Diff(M)$ there exists an invertible operator, known as the \emph{Koopman operator}, given by
\begin{align*}
	f \in L^\infty(M) \mapsto \Phi^* f := f \circ \Phi \in L^\infty(M),
\end{align*}
where $f \circ \Phi$ denotes the composition of $f:M \to \mathbb{C}$ with $\Phi:M \to M$.
This is a (right) group action of $\Diff(M)$ on $L^\infty(M)$.
The Koopman operator satisfies
\begin{align*}
	\Phi^*(f+g) = \Phi^*f + \Phi^*g \text{ and } \Phi^*(f\cdot g) = (\Phi^*f) \cdot (\Phi^*g)
\end{align*}
for any two functions real-valued functions $f,g \in L^\infty(M)$.
The inverse of the Koopman operator is merely the Koopman operator associated to $\Phi^{-1}$, that is $(\Phi^*)^{-1} = (\Phi^{-1})^*$.
In summary, the Koopman operator is a $*$-automorphism of $L^\infty(M)$
because the diagram
\begin{equation} \label{cd:classical_ring}
	\xymatrix{
		L^\infty(M) \times L^\infty(M)  \ar[d]_{+,\cdot} & \ar[l]_{ \Phi^*} L^\infty(M) \times L^\infty(M)  \ar[d]_{+,\cdot} \\
		L^\infty(M) \ar[d]_{\dagger} & \ar[l]_{\Phi^*} L^\infty(M) \ar[d]^{\dagger} \\
		L^\infty(M) & \ar[l]_{\Phi^*} L^\infty(M)
	}
\end{equation}
commutes for any $\Phi \in \Diff(M)$.

If we let $\Phi^t_X: M \to M$ be the time $t $ flow of some vector-field $X \in \mathfrak{X}$
we may define the Lie-derivative of a function $f$ to be
\begin{align*}
	\pounds_X[f] = \left. \frac{d}{d t} \right|_{t=0} (\Phi_X^t)^*f.
\end{align*}
In a local coordinate chart $(x^1,\dots,x^n)$ the vector-field is given by $X = X^i \pder{}{x^i}$
and the Lie-derivative is simply given by $\pounds_{X}[f] = X^i \pder{f}{x^i}$.
As the Koopman operator $(\Phi_X^t)^*$ is a ring-morphism, we find that the Lie-derivative operator is a (densely defined) derivation on $L^\infty(M)$.
This means
\begin{align*}
	\pounds_X[ f \cdot g] = \pounds_X[f] \cdot g + f \cdot \pounds_X[g]
\end{align*}
for any $f,g \in L^\infty(M)$ such that the above expression makes sense.
We can define $C^1(M)$ as the sub $C^*$-algebra of $L^\infty(M)$ such that $\pounds_X[f] \in L^\infty(M)$ for any $X \in \mathfrak{X}(M)$.
Iteratively, we can defined $C^{k+1}(M)$ as the sub $C^*$-algebra of $C^{k}(M)$ such that $\pounds_X[f] \in C^k(M)$ for any $X \in \mathfrak{X}(M)$.

As the Koopman operator is continuous on $L^\infty(M)$,
we may form the continuous dual mapping $\Phi_*: L^1(M) \to L^1(M)$,
known by many as the \emph{Perron-Frobenius operator}.
Given $\mu \in L^1(M)$, we define $\Phi_* \mu$ as the unique density such that
\begin{align*}
	\int_M f \cdot \Phi_* \mu = \int_M (\Phi^*f ) \cdot \mu \quad \forall f \in L^\infty(M).
\end{align*}
As $L^1(M)$ is pre-dual to $L^\infty(M)$, it must be topologized by the dual-norm.
In particular, $L^1(M)$ is a Banach space with respect to the norm
\begin{align*}
	\| \mu \|_{1}  = \sup_{
		\substack{
				f \in L^\infty(M) \\
				\| f \|_{\infty} = 1
		}
	} \langle f , \mu \rangle =: \int_M | \mu |
\end{align*}
and the Perron-Frobenius operator preserves this norm.
These relationships are summarized by asserting that the diagram
\begin{equation} \label{cd:classical_duality}
	\xymatrix{
		& \ar[dl]_{\| \cdot \|_{\infty}} L^\infty(M) & \ar[l]_{\pi_1} L^\infty(M)\times L^1(M) \ar[d]_{\langle \cdot , \cdot \rangle} \ar[r]^{\pi_2} & L^1(M)   \ar[dd]^{\Phi_*} \ar[dr]^{\| \cdot \|_{1}}& \\
		\mathbb{R} && \mathbb{C} && \mathbb{R} \\
		& \ar[ul]^{\| \cdot \|_{\infty}} L^\infty(M) \ar[uu]_{\Phi^*} & \ar[l]_{\pi_1} L^\infty(M)\times L^1(M) \ar[u]^{\langle \cdot , \cdot \rangle} \ar[r]^{\pi_2} & L^1(M) \ar[ur]_{\| \cdot \|_{1}} &	
	}
\end{equation}
commutes for any $\Phi \in \Diff(M)$.

The cones of non-negative functions and non-negative distributions will play a special role later in terms of applications.
One can observe that the subring of non-negative functions, $L^\infty(M ; \R^+_0)$ is invariant under the Koopman operator.
That is to say, $\Phi^*f$ is a non-negative function if and only if $f$ is a non-negative function.
The same holds in regards to the Frobenius-Perron operator and non-negative distributions.

By the change of variables formula we see that $\Diff(M)$ acts isometrically on $L^2(M)$ through \eqref{eq:transformation_law} with respect to 
the inner product $\langle \cdot \mid \cdot \rangle$.
Let us denote $\rho(\Phi)$ as the unitary operator on $L^2(M)$
\begin{align*}
	\rho(\Phi) \cdot \psi = ( \Phi^{-1})^* \psi.
\end{align*}
The conservation properties of $\Phi$ with regards to $L^2(M)$ can be summarized by asserting that the diagram
\begin{equation*}
	\xymatrix{
		L^2(M) \times L^2(M) \ar[dr]_{\langle \cdot \mid \cdot \rangle} \ar[r]^{ \rho(\Phi)} & L^2(M) \times L^2(M) \ar[d]^{\langle \cdot \mid \cdot \rangle} \\
		&\mathbb{R}
	}
\end{equation*}
commutes.

As $\Diff(M)$ acts isometrically upon $L^2(M)$ the Lie algebra $\mathfrak{X}(M)$ must act by a (densely defined) anti-Hermetian operators.
In particular, we define the Hilbert-Lie derivative as the anti-Hermetian operator $\rho(X)$ given by
\begin{align*}
	\rho(X) \cdot \psi  := \frac{d}{dt} |_{t=0} \rho(\Phi_t) \cdot \psi
\end{align*}
where $\Phi_t$ is the time $t \in \R$ flow of $X$.
In coordinates the Hilbert-Lie derivative is given by
\begin{align*}
	\left(\rho(X) \cdot \psi \right)(x) = \frac{1}{2} X^i (x) \left.\pder{\psi}{x^i}\right|_{x}+ \frac{1}{2} \left.\pder{}{x^i}\right|_{x} \left(\psi \cdot X^i \right).
\end{align*}
Given a function $f \in C^\infty(M)$ there is a unique bounded symmetric operator $\hat{f} : L^2(M) \to L^2(M)$
given by
\begin{align}
	(\hat{f} \cdot \psi)(x) = f(x) \psi(x). \label{eq:function_op}
\end{align}
Moreover, we find
\begin{align}
	\pounds_{f\cdot X}[\psi] = \hat{f} \cdot \pounds_X[\psi] + \frac{1}{2} \widehat{\pounds_{X}[f] }\cdot \psi. \label{eq:module}
\end{align}
This tells us how to represent the multiplication of a vector-field by a function as a generator on the space of half-densities.
Admittedly, half-densities are an obscure object which would be of no interest to us, except for the fact that they will guide
our discretization procedure in section \ref{sec:convergence}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Advection on Hilbert spaces}
\label{sec:Hilbert}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
In this section we review $C^*$-algebra analogs of the structures provided in the section \ref{sec:classical}.
In particular, this section is nearly a copy of the previous section except that the notion of a point in $M$ has been replaced with a ray in a Hilbert space $\mathcal{H}$.

To begin, note that $\H$ is equipped with the following canonical structures:
\begin{enumerate}
	\item The topological group of isometries, $\U(\H)$.
	\item The of densely defined anti-Hermetian operators $\mathfrak{su}(\H)$.
	\item The $C^*$-algebra of bounded operators $( \B(\H) , \| \cdot \|_{\Op})$.
	\item The trace-class operators equipped with the trace norm $(\B(\H)^*,\| \cdot \|_{\Op^*})$.
	\item The positive-semidefinite operators $\Herm^+(\H) \subset \B(\H)$.
\end{enumerate}
Each of these entities is linked to the others in a network of relationships
which we shall review here.
Moreover, these relationships will suggest the following analogies
\begin{itemize}
	\item $\U(\H)$ is analogous to $\Diff(M)$
	\item $\mathfrak{su}(n)$ is analogous to $\mathfrak{X}(M)$.
	\item $\B(\H)$ is analogous to $L^\infty(M)$.
	\item $\B(\H)^*$ is analogous to $L^1(M)$.
	\item $\Herm^+(\H)$ is analogous to $C(M;\R^+)$.
	\item $\H$ is analogous to $\Dens^{1/2}(M)$.
\end{itemize}
For starters, for any $U \in \U(\H)$ there exists an automorphism on $\B(\H)$, which we call the \emph{Hilbert-Koopman operator} and denote by $\Con_U$.
The Hilbert-Koopman operator is explicitly given by
\begin{align*}
	\Con_U( \hat{f} ) := U^\dagger \cdot \hat{f} \cdot U
\end{align*}
We can observe that Hilbert-Koopman operator preserves the operator norm
and is therefore a \emph{continuous} group action of $\U(\H)$ on $\B(\H)$ which satisfies
\begin{align*}
	\Con_U(\hat{f}+\hat{g}) &= \Con_U(\hat{f}) + \Con_U(\hat{g}) \quad,\quad
	\Con_U(\hat{f} \cdot \hat{g}) = \Con_U(\hat{f}) \cdot \Con_U(\hat{g}) \quad,
	\intertext{and}
	\quad \Con_U( \hat{f}^\dagger) &= \Con_U(\hat{f})^\dagger
\end{align*}
for any two $\hat{f},\hat{g} \in \B(\H)$.
In summary, the Hilbert-Koopman operator is a $C^*$-automorphism of $\B(\H)$.
This is summarized by the commutativity of the diagram
\begin{equation} \label{cd:quantum_ring}
	\xymatrix{
		\B(\H) \times \B(\H)  \ar[d]_{+,\cdot} & \ar[l]_{\Con_U} \B(\H) \times \B(\H)  \ar[d]_{+,\cdot} \\
		\B(\H)  \ar[d]_{\dagger}& \ar[l]_{\Con_U} \B(\H) \ar[d]^{\dagger} \\
		\B(\H)  & \ar[l]_{\Con_U} \B(\H) \\
	}
\end{equation}
for any $U \in \U(\H)$.

Courtesy of the Stone-Von Neumann theorem \cite{Conway1990},
for any $\omega \in \mathfrak{su}(\H)$ we may define a one-parameter unitary group $U(t) = \exp( \omega t) \in \U(\H)$
by the property that $\frac{d}{dt} U(t) = \omega \circ U(t)$.
We may then define the \emph{Hilbert-Lie derivative} of $\hat{f} \in \B(\H)$ to be
\begin{align*}
	\pounds_{\omega}[ \hat{f}] := \left. \frac{d}{d t} \right|_{t=0} \Con_{U(t)}(\hat{f} ) = \hat{f} \cdot \omega - \omega \cdot \hat{f} = [ \hat{f} , \omega].
\end{align*}
where $[ \cdot , \cdot ]$ denotes the commutator bracket.
As the Hilbert-Koopman operator is a ring-morphism, we can observe that the discrete Lie derivative is a (non-commutative) derivation.
That is to say
\begin{align*}
	\pounds_{\omega}[ \hat{f} \cdot \hat{g} ] = \pounds_{\omega} [ \hat{f}] \cdot \hat{g} + \hat{f} \cdot \pounds_{\omega} [\hat{g}]
\end{align*}
for any $\hat{f},\hat{g} \in \B(\H)$.
Note that it is possible for $\pounds_{\omega}[\hat{f}]$ to be an unbounded operator.
This fact will be used later to define a $C^*$-algebra based definition of differentiability.

We define the Hilbert-Lie derivative of a trace-class operator $\hat{\rho} \in \B(n)^*$ as the dual map of the discrete Lie derivative operator.
In particular $\pounds_\omega[\hat{\rho}] = [\omega,\hat{\rho}]$.


We may also form the (pre)dual mapping $\Con_U^*: \B(\H)^* \to \B(\H)^*$,
which we shall dub the \emph{Hilbert-Perron-Frobenius operator}.
Given a $\mu \in \B(n)^*$, we may define $\Con_U^*(\mu)$ by the constraint
\begin{align*}
	\langle \hat{f} , \Con_U^*(\mu) \rangle = \langle \Con_U(\hat{f}) , \mu \rangle \quad \forall \hat{f} \in \B(\H).
\end{align*}
This implies $\Con_U^*(\mu) = U \cdot \mu \cdot U^\dagger$.
We naturally equip $\B(\H)^*$ with the norm dual to that chosen on $\B(\H)$.
In particular, $\B(\H)^*$ is  equipped with the norm
\begin{align*}
	\| \mu \|_{\Op^*} = \sum_{s \in \Sigma(\mu) } s
\end{align*}
where $\Sigma(\mu)$ denotes the set of singular values of $\mu \in \B(\H)^*$.
The discrete Perron-Frobenius operator preserves this norm.
These relationships are summarized in the commutativity of the diagram
\begin{equation} \label{cd:quantum_duality}
	\xymatrix{
		& \ar[dl]_{\| \cdot \|_{\Op}} \B(\H) & \ar[l]_{\pi_1} \B(\H)\times \B(\H)^* \ar[d]_{\langle \cdot \mid \cdot \rangle} \ar[r]^{\pi_2} & \B(\H)^*   \ar[dd]_{\Con_U^*} \ar[dr]^{\| \cdot \|_{\Op^*}}& \\
		\mathbb{R} && \mathbb{C} && \mathbb{R} \\
		& \ar[ul]^{\| \cdot \|_{\Op}} \B(\H) \ar[uu]_{\Con_U} & \ar[l]_{\pi_1} \B(\H)\times \B(\H)^* \ar[u]^{\langle \cdot \mid \cdot \rangle} \ar[r]^{\pi_2} & \B(\H)^* \ar[ur]_{\| \cdot \|_{\Op^*}} &	
	}
\end{equation}

The cones of positive semi-definite operators and the dual cone will play a special role.
One can observe that the cone $\Herm^+(\H)$ is invariant under the Hilbert-Koopman operator.
The same holds in regards to the discrete Frobenius-Perron operator on the dual cone $(\Herm^+(\H))^*$.

Finally, we note that the very definition of $\U(\H)$ is that its elements preserve the inner-product on $\H$.
In other words the diagram
\begin{equation*}
	\xymatrix{
		\H \times \H \ar[dr]_{\langle \cdot \mid \cdot \rangle} \ar[r]^{ U \times U} & \H \times \H \ar[d]^{\langle \cdot \mid \cdot \rangle} \\
		&\mathbb{C}
	}
\end{equation*}
commutes.

This is all very ``cute'', but what good is this analogy for the purpose of understanding
classical advection
unless we provide a link between the Hilbert and the classical regimes?
We hope to answer this question in the next section.

%Finally, we introduce the inner-product space of half-densities.
%Roughly speaking, a half-density is an object whose square is a density, and they act much like
%the smooth wave-functions which one encounters in quantum mechanics.
%More formally, a smooth half density on $M$ is a smooth multiliear function $\psi : \bigwedge^n TM \to \mathbb{R}$
%such that for any matrix $A$ and vectors $v_1,\dots,v_n$ over the same fiber
%\begin{align*}
%	\psi( (A_1^j v_j) \wedge \cdots \wedge (A_n^j v_j) ) =  | \det(A) |^{1/2} \psi(v_1 \wedge \cdots \wedge v_n).
%\end{align*}
%We define the space of half-densities by $\Dens^{1/2}(M)$.
%Such objects were first invented for the purpose of geometric quantization \cite[see Chapter 4]{GuilleminSternberg1970}.
%Note that the function $\psi^2 : \bigwedge^n TM \to \R$ is a density, and can be integrated.
%More generally, given $\psi_1,\psi_2 \in \Dens^{1/2}(M)$ we define $\langle \psi_1 \mid \psi_2 \rangle := \int_M \psi_1 \cdot \psi_2$
%where $\psi_1 \cdot \psi_2 $ denotes the density obtained by scalar multiplication.
%One can observe that $\langle \cdot \mid \cdot \rangle$ is an inner product on $\Dens^{1/2}(M)$.
%Given a $\Phi \in \Diff(M)$, there is a canonical (right) action on $\Dens^{1/2}(M)$ given by
%\begin{align*}
%	\Phi^* \psi( v_1 \wedge \cdot \wedge v_n) := \psi( D\Phi(v_1) \wedge \cdots \wedge D\Phi(v_n) )
%\end{align*}
%where $D\Phi : TM \to TM$ denotes the tangent lift of $\Phi$.
%By the change of variables formula we see that $\Diff(M)$ acts isometrically on $\Dens^{1/2}(M)$ with respect to 
%the inner product $\langle \cdot \mid \cdot \rangle$.
%Admittedly, this is an obscure object which would be of no interest to use, except for the fact that it will guide
%our discretization procedure in the next section.
%
%We can summarize what has been presented so far in the following commutative diagrams
%\begin{align*}
%	\xymatrix{
%		\Op(n) \times \Op(n)  \ar@<-0.6ex>[d]_{+} \ar@<0.6ex>[d]^{\cdot} & \ar[l]_{R^*} \Op(n) \times \Op(n)  \ar@<-0.6ex>[d]_{+} \ar@<0.6ex>[d]^{\cdot} \\
%		\Op(n)  & \ar[l]_{R^*} \Op(n)
%	}, \\
%	\xymatrix{
%		& \ar[dl]_{\| \cdot \|_{\Op}} \Op(n) & \ar[l]_{\pi_1} \Op(n)\times \Op(n)^* \ar[d]_{\langle \cdot , \cdot \rangle} \ar[r]^{\pi_2} & \Op(n)^*   \ar[dd]^{(R^*)^*} \ar[dr]^{\| \cdot \|_{\Op^*}}& \\
%		\mathbb{R} && \mathbb{R} && \mathbb{R} \\
%		& \ar[ul]^{\| \cdot \|_{\Op}} \Op(n) \ar[uu]_{R^*} & \ar[l]_{\pi_1} \Op(n)\times \Op(n)^* \ar[u]^{\langle \cdot , \cdot \rangle} \ar[r]^{\pi_2} & \Op(n)^* \ar[ur]_{\| \cdot \|_{\Op^*}} &	
%	} \\
%	\xymatrix{
%		\R^n \times \R^n \ar[dr]_{\langle \cdot \mid \cdot \rangle} \ar[r]^{R^*} & \R^n \times \R^n \ar[d]^{\langle \cdot \mid \cdot \rangle} \\
%		&\mathbb{R}
%	}	.
%\end{align*}


\section{A $C^*$-representation of advection on manifolds}
\label{sec:embedding}
Let $M$ be a compact manifold.
In order to link section \ref{sec:classical} and section \ref{sec:Hilbert}
we will reformulate our representations of functions, densities, and diffeomorphisms as operators on the Hilbert space $\H = L^2(M)$.
To begin, the mapping
\begin{align*}
	\rho: f \in L^\infty(M) \mapsto \hat{f} \in \B(\H)
\end{align*}
given in \eqref{eq:function_op} is a $C^*$-monomorphism.
More over, for any $\Phi \in \Diff(M)$ the Koopman operator acting on $L^\infty(M)$ is mapped to the Hilbert-Koopman operator acting on $\H$ when we embed the function in $\B( \H )$ through this map.
In summary, the map $\rho$ embeds the commutative diagram \eqref{cd:classical_ring} into the commutative diagram \eqref{cd:quantum_ring}.
This is represented by the commutative diagram
\begin{align*}
	\xymatrix@=1em{
		L^\infty(M) \times L^\infty(M) \ar[dr]^{\rho} \ar[dd]_<(0.2){+,\cdot} & & \ar[ll]_<(0.1){ \Phi^*} L^\infty(M) \times L^\infty(M) \ar[dr]^{\rho} \ar[dd]_<(0.2){+,\cdot}|!{[dr];[dl]}\hole \\
		& \B( \H ) \times \B(\H) \ar[dd]_<(0.2){+,\cdot} & & \ar[ll]^<(0.1){\Con_{\rho(\Phi)}} \B(\H) \times \B(\H) \ar[dd]_<(0.2){+,\cdot} \\
		L^\infty(M) \ar[dr]^{\rho} \ar[dd]_<(0.2){\dagger} & & \ar[ll]_<(0.2){\Phi^*}|!{[ul];[dl]}\hole L^\infty(M) \ar[dr]^{\rho} \ar[dd]_<(0.2){\dagger}|!{[dr];[dl]}\hole \\
		& \B(\H) \ar[dd]_<(0.2){\dagger} & & \ar[ll]^<(0.2){\Con_{\rho(\Phi)}} \B(\H) \ar[dd]_<(0.2){\dagger} \\
		L^\infty(M) \ar[dr]^{\rho} & & \ar[ll]_<(0.2){\Phi^*}|!{[ul];[dl]}\hole L^\infty(M) \ar[dr]^{\rho} \\
		& \B(\H) & & \ar[ll]^<(0.2){\Con_{\rho(\Phi)}} \B(\H)
	}
\end{align*}
which commutes for any $\Phi \in \Diff(M)$.
This map is continuous because $\| \hat{f} \|_{\Op} = \| f \|_{\infty}$.

Dually, for each density $\mu \in L^1(M)$ there is a unique trace-class operator $\hat{\mu} \in \B(L^2(M))^*$ defined
such that $ \hat{\mu} (\hat{f}) = \int_M f \cdot \mu $.
In particular, we may choose a half-density $\sqrt{\mu} \in \Dens^{1/2}(M)$ with the property that $\mu = |\sqrt{\mu}|^{2}$.
The half-density $\sqrt{\mu}$ is defined uniquely modulo a non-unique phase and $\hat{\mu} = \sqrt{\mu} \otimes \sqrt{\mu}^\dagger$.
The map $\mu \mapsto \hat{\mu}$ is continuous because $\| \hat{\mu} \|_{\Op^*} = \| \mu \|_{1}$.
Finally, given a $\Phi \in \Diff(M)$ one can then verify
\begin{align*}
	\rho( \Phi^* f ) = \Con_{\rho(\Phi)} ( \rho(f)) \quad \text{ and } \quad
	\rho( \Phi_* \mu) = \Con_{\rho(\Phi)}^*(\rho(\mu) )
\end{align*}
for any $f \in L^\infty(M)$ and $\mu \in L^1(M)$.
In summary, $\rho$ embed the constructions of section \ref{sec:classical} into the constructions of section \ref{sec:Hilbert}.
This is represented in the grammer of commutative diagrams by saying that the $\rho$ embed diagram \eqref{cd:classical_duality}
into diagram \eqref{cd:quantum_duality}.
This is given by the commutative diagram
\begin{equation}
	\xymatrix@=1em{
		L^\infty(M) \ar[dr] & & \ar[ll]_{\pi_1} L^\infty(M) \times L^1(M) \ar[dd]_<(0.2){\langle \cdot ,\cdot \rangle}|!{[dr];[dl]}\hole  \ar[dr] \ar[rr]^{\pi^2} & & L^1(M) \ar[dr] \ar[dddd]_{\Phi_*}|!{[dl];[dr]}\hole & \\
		& \B(\H) & & \ar[ll]_<(0.2){\pi_1} \B(\H) \times \B(\H)^* \ar[dd]_{\langle \cdot ,\cdot \rangle} \ar[rr]^{\pi_2} & & \B(\H)^* \ar[dddd]_{\Con^*_{\rho(\Phi)}} \\
		& & \mathbb{C} \ar@{=}[dr] & & & \\
		& & & \mathbb{C} & & \\
		L^\infty(M) \ar[dr] \ar[uuuu]^{\Phi^*} & & \ar[ll]_{\pi_1}|!{[dl];[uuul]}\hole L^\infty(M) \times L^1(M) \ar[dr]  \ar[rr]^<(0.2){\pi_2}|!{[dr];[ur]}\hole \ar[uu]^{\langle \cdot,\cdot \rangle} & & L^1(M) \ar[dr] & \\
		& \B(\H) \ar[uuuu]^{\Con_{\rho(\Phi)}} & & \ar[ll]_{\pi_1} \B(\H) \times \B(\H)^* \ar[uu]_<(0.2){\langle \cdot , \cdot \rangle} \ar[rr]^{\pi_2} & & \B(\H)^*
	}
\end{equation}

Moreover, for each vector-field $\mathfrak{X}(M)$ there is a (densely defined) anti-symmetric operator $\rho(X) \in \mathfrak{su}(\H)$
given by $\rho(X) \cdot \psi =  - \left. \frac{d}{dt} \right|_{t=0} \rho(\Phi_t) \cdot \psi$
where $\Phi_t \in \Diff(M)$ denotes the flow of $X$.

We now precondition our understanding of advection in order to create 
a discretization procedure for the PDEs presented in the introduction.
We begin by viewing these PDE's as ODEs on operator spaces.
\begin{prop}\label{prop:operator}
	The quantities $f,\mu$, and $Y$ are solutions of \eqref{eq:function_pde}, \eqref{eq:density_pde}, and \eqref{eq:vf_pde} respectively
	if and only if the operators $\hat{f} = \rho(f),\hat{\mu} = \rho(\mu)$ and $\widehat{Y} = \rho(Y)$ are solutions of
	\begin{align} \label{eq:operator_evolution}
		\frac{d\hat{f}}{dt} + [ \hat{f} , \widehat{X} ] = 0 \quad,\quad
		\frac{d\hat{\mu}}{dt} + [ \widehat{X}, \hat{\mu} ] = 0 \quad,\quad
		\frac{d\widehat{Y}}{dt} + [ \widehat{X} , \widehat{Y} ] = 0.
	\end{align}
	where $\widehat{X} = \rho(X)$.
\end{prop}
\begin{proof}
	\todo[inline]{Proof coming soon}
\end{proof}
What proposition \ref{prop:operator} suggests is that we may discretize the operator equation \eqref{eq:operator_evolution} in lieu of numerically approximating  \eqref{eq:function_pde}, \eqref{eq:density_pde}, and \eqref{eq:vf_pde}.
In particular, we can discretize all the relevent operators spectrally by choosing an orthonormal basis of $\mathcal{H}$.
This brings us to our discretization procedure.

\section{Discretization and convergence}
\label{sec:discretization}
Let $M$ be compact and closed.  In this case $\H = L^2(M)$ is a separable Hilbert space
and we may choose a countable Hilbert basis $\{ e_1 , e_2 , \dots \}$.
Without loss of generality we will assume that each basis element is of class $H^s$ for $s > 1$.
Let $\H_N = {\rm span}\{ e_1, \dots ,e_N \}$, let
$\pi_N$ be the orthogonal projection of $\H$ onto $\H_N$,
 and let $i_N: \H_N \to \H$ be the canonical embedding.
Given a vector-field $X \in \mathfrak{X}(M)$ define $[X]_N = \pi_N \circ \rho(X) \circ i_N$.
We see that $[X]_N : \H_N \to \H_N$ 
operates on a finite dimensional inner product space,
and so we can represent $[X]_N$ as a $N\times N$ complex matrix using 
the basis $\{ e_1,\dots, e_N\}$.
Specifically, $[X]_N$ is given in bra-ket notation by
\begin{align*}
	[X]_N:= \sum_{i,j = 1}^{N} \mid e_i \rangle \langle e_i \mid \rho(X) \mid e_j \rangle  \langle e_j \mid
\end{align*}
In the same vain, given a function $f \in L^\infty(M)$ define $[f]_N = \pi_N \circ \hat{f} \circ i_N$,
and for a density $\mu \in L^1(M)$ define $[\mu]_N = \pi_N \circ \hat{\mu} \circ i_N$.

\begin{prop} \label{prop:inf_convergence}
	If $\psi \in L^s(M)$ is of class $H^s$ and $s>1$ then
	$\lim_{N \to \infty}( \| [X]_N \psi - \rho(X) \cdot \psi \|_{2} ) = 0$.
\end{prop}
\begin{proof}
	Let $g$ be an arbitrary metric on $M$.
	The operator $\rho(X)$ is a first order differential operator and thus a bounded operator from $H^{s}$
	to $H^{s-1}$.
	Moreover, the embedding $i: H^{s-1}(M) \hookrightarrow L^2(M)$ is compact by Proposition \ref{prop:compact_embedding}.
	Thus the map $i \circ \rho(X) |_{H^s(M)}$ is compact as well and can be viewed as the limit of the finite rank operator $[X]_N$.
\end{proof}

\begin{thm} \label{thm:convergence}
	For $\psi_0$ of class $H^s$ with $s>1$
	$\| \exp([X]_N) \cdot \psi_0 - \rho(\Phi_t) \cdot \psi_0 \|_{2} \to 0$ as $N \to \infty$.
\end{thm}

\begin{proof}
	Let $\psi_N(t)$ satisfy $\partial_t \psi_N = [X]_N \psi_N$ and let $\psi(t)$ satisfy $\partial_t \psi = \rho(X) \cdot \psi$ each with initial conditions $\psi(0) = \psi_N(0) = \psi_0$.
	Let $u(t) = \| \psi_N(t) - \psi(t) \|_{2}$.
	We calculate
	\begin{align*}
		\frac{du}{dt} &= \frac{1}{2u(t)} \langle [X]_N \psi_N - \rho(X) \cdot \psi , \psi_N - \psi \rangle \\
			&= \frac{1}{2u} \langle [X]_N \cdot (\psi_N - \psi) + ([X]_N - \rho(X) ) \cdot \psi , \psi_N - \psi \rangle \\
			&= \frac{1}{2u} \langle ([X]_N - \rho(X) ) \psi , \psi_N - \psi \rangle \\
			&\leq \frac{1}{2u(t)} \| [X]_N |_{H^s} - \rho(X)|_{H^s} \|_{op} \cdot \| \psi \|_{H^s} \cdot \| \psi_N - \psi \|_2 \\
			&= \frac{\epsilon_N}{2} \| \psi \|_{H^s}.
	\end{align*}
	By Proposition \ref{prop:inf_convergence} we know that $\epsilon_N \to 0$ as $N \to \infty$.
	Thus, in order to prove convergence we need only show that $\psi$ is in $H^s$.
	In local coordinates we may represent $\psi$ and $\psi_0$ as functions.
	In particular, they are related by
	$\psi(t , x) = \left| \det (D\Phi_t^{-1})|_{\Phi_t(x)}  \right|^{1/2} \psi_0( \Phi_t^{-1}(x) )$
	where $\Phi_t \in \Diff(M)$ is the flow of the vector-field $X$.
	The regularity of $\psi_0 \in H^s$ is covariant, and so the function $\psi( \Phi_t^{-1}(x) ) \in H^s$.
	Moreover, $\left| \det (D\Phi_t^{-1})|_{\Phi_t(x)}  \right|^{1/2}$ is smooth and therefore the product $\psi(t,x) = \left| \det (D\Phi_t^{-1})|_{\Phi_t(x)}  \right|^{1/2} \psi_0( \Phi_t^{-1}(x) )$
	is $H^s$ for all $t$.
\end{proof}

\begin{thm}
	If $f,\mu,Y$ solve blah and $[f]_N,[\mu]_N, [Y]_N$ solve blah
	then $[f]_N$... converge to $\hat{f},\hat{\mu}$ and $\widehat{Y}$ in some sense.
\end{thm}


\section{Wavelets and sparsity}
\label{sec:wavelets}
We would like to apply wavelet theory for the purpose of the error bounds,
and sparsity structure they bring to the problem.
However, the notion of wavelets on manifolds is still in development,
and virtually all of the available software infrastructure is built for wavelets on flat spaces.
This motivates us to prove the following theorem.

\begin{thm} \label{thm:global_chart}
  Let $M$ be a compact connected manifold and let
  $\phi:U \subset M \to V \subset \mathbb{R}^n$
  be a chart such that $\bar{U} = M$.
  Then the subspace of half-densities over $V$ given by
  $(i_U \circ \phi^{-1})^* \Dens^{1/2}(M)$ is isomorphic
  to $\Dens^{1/2}(M)$.
\end{thm}
\begin{proof}
  Elements of $(i_U \circ \phi^{-1})^* \Dens^{1/2}(M)$
  are half-densities on $V \subset \mathbb{R}^n$ given by $ \left. \psi \right|_{U} \circ \Fr(\phi)$ for some $\psi \in \Dens^{1/2}(M)$.
  Thus the map $\psi \mapsto \psi|_U \circ \Fr(\phi)$ provides a surjection.
  We wish to show that this map is also an injection.
  Specifically this means, given $\left. \psi \right|_{U} \circ \Fr(\phi)$ in $(i_U \circ \phi^{-1})^*\Dens^{1/2}(M)$ the half-density $\psi$ is uniquely determined.
  To prove this, assume that there exists another half-density,
  $\tilde{\psi}$, such that $\tilde{\psi}|_U \circ \phi^{-1} = \psi|_U \circ \phi^{-1}$.
  For any $x \in V$ and ${\bf e}_x \in \Fr_x(V)$ we observe that
  \begin{align*}
    \tilde{\psi}( \Fr_x(\varphi) \cdot {\bf e}_x) = \psi( \Fr_x( \varphi) \cdot {\bf e}_x).
  \end{align*}
  Applying this over all $x \in V$ matches $\psi$ and $\tilde{\psi}$ on the set $U$.
  However, $\psi$ and $\tilde{\psi}$ are both smooth.
  Therefore, the only place where $\psi$ and $\tilde{\psi}$ may differ is on $M \ U$.
  As $U$ is dense in the compact space $M$,
  the extension of $\psi|_U$ to $M$ is unique.
  Thus $\psi = \tilde{\psi}$.
\end{proof}

  Theorem \ref{thm:global_chart} is useful because in translates computations on manifolds to computation on compact subspaces of $\mathbb{R}^n$.

\begin{defn}
  Let $M$ be a compact connected manifold (with or without boundary), and let $\phi:U \subset M \to V \subset \mathbb{R}^n$ be a chart such that $U$ is dense in $M$.
  Let $W_s \subset C^k(\bar{V})$ be a nested sequence of function spaces
  with respect to the scale paramenter $s \in \mathbb{Z}$.
  We call the pair $(\phi, W_s)$ a \emph{Computational realization of $M$}
  if $\phi^* i_V^*W_s \subset i_{U}^* C^k(M)$ for each $s$ and $\cup_s \phi^*i_V^*W_s$ is dense in $i_{U}^*C^k(M)$.
\end{defn}

The constraint ``$\phi^*i_V^*W_s \subset i_U^* C^k(M)$'' enforces that each of the spaces $W_s$ models the function space $i_U^* C^k(M)$ and nothing more.
By theorem \ref{thm:global_chart}, $i_U^* C^k(M) = C^k(M)$, and thus $W_s$ models a subspace of the functions on $C^k(M)$.
The second constraint ensures that elements of $i_U^* C^k(M)$ can be approximated by $W_s$ for some $s \in \mathbb{Z}$.

\subsection{Examples of computational realizations of manifolds}
In this subsection we provide a list of illustrative examples for computational realizations
\begin{example}
Let $W_s$ for $s \in \mathbb{N}$ denote the subspace of $C^k( [-\pi,\pi])$ given by:
\begin{align*}
  W_s = \bigcup_{k=1}^{s} \{ \sin( k x),\cos( kx) \}.
\end{align*}
Let $S^1$ be represented by the subset of the complex plane $\{ e^{ix} \mid x \in \mathbb{R} \}$.
Let $U = \{ e^{ix} \mid x \in (-\pi,\pi) \}$.
Finally, let $\phi: U \to (-\pi,\pi)$ be the chart $\phi( e^{ix}) = x$.
We see that $i_U^*C^k(S^1)$ is isomorphic to the subspace of $C^k$-functions on $(-\pi,\pi)$
which can be extended to $C^k$ functions on $[-\pi,\pi]$ with periodic boundary conditions up to order $k$.
As summations of sinuisoids are dense in the space of periodic function on $[-\pi,\pi]$ we see that $(\phi,W_s)$ is a computational domain for $S^1$.
\end{example}
\begin{example}
n - sphere
\end{example}
\begin{example}
Klein bottle
\end{example}
\begin{example}
RP2
\end{example}

\subsection{Error analysis}
\label{sec:error}
Let $(\phi,W_s)$ be a wavelet realization of $d$-manifold, $M$,
where $\phi: U \subset M \to V \subset \mathbb{R}^n$.
Each $X \in \mathfrak{X}(M)$ can be pushed to a vector field on $V$ through the map $\phi$.
As a result, the operator $\rho(X) \in \mathfrak{su}( L^2(M) )$ is pushed to the operator $\rho(\phi_*(X)) \in \mathfrak{su}(L^2(V))$.
More concretetly, the vector-field $X$ will appear in local coordinates induced by $\phi$ as
\begin{align*}
  \phi_*X(x) = q_i(x) \frac{\partial}{\partial x^i}.
\end{align*}
The operator on half-densities $\rho(\phi_*X)$ can be written in terms of coordinates on $\R^n$ as
\begin{align*}
  \rho(\phi_*X)[\psi](x) =  q_i(x) \partial_i \psi(x) + \left( \frac{1}{2} \partial_i q_i(x) \right) \psi(x).
\end{align*}
 To simplify analysis we will simply write this operator as a sum over multi-indices $(\rho(\phi_*X) [\psi] )(x) = \sum_{|\alpha|\leq 1} a_\alpha(x) \partial^\alpha \psi(x)$ with (local) coefficients $a_\alpha \in \phi_*i_{U}^*C^{\infty}(M) \subset C^{\infty}(\bar{V})$. Assume that $(\psi_\lambda)_{\lambda \in \Lambda}$ and $(\tilde{\psi}_\lambda)_{\lambda \in \Lambda}$ are a pair of wavelet bases. We denote by $P_j$ the projection onto the scaling functions associated with $\psi$ of resolution $2^{-j}$. We also let $\card{\lambda}$ denote the resolution level of the index $\lambda$. 

Define weighted spaces as:
\begin{equation}
	\ell_t^2(\Lambda) = \left\{ (c_\lambda)_{\lambda \in \Lambda}  \mid \norm{(c_\lambda)}_{\ell^2_t}^2 = \sum_{\lambda \in \Lambda} 2^{2t\card{\lambda}}\abs{c_\lambda}^2 < \infty  \right\}.
\end{equation}
When $t = 0$ we write $\ell^2$ for the aforementioned weighted space. We are interested in evaluating the entries:
\begin{equation}
	[X]_{\lambda,\mu} = \langle \rho(\phi_*X) \psi_\lambda, \tilde{\psi}_\mu \rangle.
\end{equation}
We let $[X]=([X]_{\lambda,\mu})_{\lambda,\mu \in \Lambda}$. Assume further that there exists an $\alpha,n \in \mathbb{N}$ such that the wavelets are in $C^{\alpha}$, $\alpha \geq \frac{d}{2} + 1$, and that the wavelets are orthogonal to polynomials of degree $n \geq \alpha - 1$.  Note by Theorem 3.6.1 in \cite{Cohen2003} the norm equivalence between elements in $W^{t,2}$ and the $l_t^2$ norm of the wavelet decomposition of that same element using either wavelet bases for $0\leq t \leq \alpha$. For the sake of convenience, we let $s = \frac{d}{2} + 1$. 

\begin{prop} \label{prop:projection_bound}
	Let $f \in W^{s,2}(M)$ and $j \geq \frac{d}{2}$ and $P_j$ denote the $L^2$-orthogonal projection onto polynomials of degree $j$.
	Then $\norm{f - P_j f}_{L^2} \leq  2^{-sj}\norm{f}_{W^{s,2}}$,
\end{prop}
\begin{proof}
	This follows from either Theorem 3.3.2 or 3.10.2 in \cite{Cohen2003}.
\end{proof}

\begin{prop} \label{lem:matrix_bound}
	$\abs{[X]_{\lambda,\mu}} \leq C 2^{-(\frac{d}{2}+\frac{1}{2})\abs{\abs{\lambda}-\abs{\mu}}}2^{\frac{1}{2}(\abs{\lambda}+\abs{\mu})}$
\end{prop}
\begin{proof}
	\begin{align*}
		\abs{[X]_{\lambda,\mu}} 	&= \int \abs{X \psi_{\lambda}(x) \tilde{\psi}_{\mu}(x)} dx \\
								&\leq \norm{\tilde{\psi}_\mu}_{L^1} \| X \psi_\lambda \|_{L^\infty}, \\ %\inf_{g \in \Pi_n} \norm{X \psi_{\lambda} - g}_{L^{\infty}} \\
							\intertext{by Theorem 3.3.1 and 3.10.2 of \cite{Cohen2003} we observe: }
								&\leq C_1 2^{-\card{\mu}\frac{d}{2}}\norm{X\psi_{\lambda}}_{L^{\infty}} \\
								&= C_1 2^{-\card{\mu}\frac{d}{2}}\norm{ \sum_{\abs{m} \leq 1 } a_m(x) \psi^{(m)}_\lambda(x) }_{L^{\infty}} \\
								&\leq C_2 2^{-\card{\mu}\frac{d}{2}}\sum_{\card{m}\leq 1}\norm{\psi_{\lambda}^{(m)}(x)}_{L^{\infty}} , \\
							\intertext{and by the definition of wavelets:}
								&\leq C_3 2^{-\card{\mu}\frac{d}{2}} 2^{\card{\lambda}\frac{d}{2}} \sum_{\card{m}\leq 1} (2^{\card{\lambda}})^{\abs{m}} \\
								&\leq C_3 (d+1) 2^{-\card{\mu}\frac{d}{2}} 2^{\card{\lambda}(1+\frac{d}{2})} \\
								&= C_4 2^{d/2(\card{\lambda} - \card{\mu})}2^{\card{\lambda}},
	\end{align*}
	%where the second line follows from the fact that $\tilde{\psi}$ is orthogonal to polynomials of degree $n$, 
	%the third line follows from Theorems 3.3.1 and 3.10.2 in \cite{Cohen2003},
	%the fourth line follows from the definition of $X$, and the fifth follows from the definition of the wavelets.
	The desired result follows from a symmetry argument and a rearrangement.
\end{proof}


\section{Structure preserving properties}
\label{sec:structure}
We get a bunch of properties at the discrete level.


give more theorems.

\section{Examples}

\subsection{A one dimensional example}

\subsection{Duffing equation}

\subsection{Rigid body dynamics}
blah blah
\todo[inline]{This is an integrable system.  It would be interesting to see the conserved functions (i.e. 0th Koopman modes)}

\subsection{A 3D example}
ABC flow

\begin{align*}
	u = A \sin(z) + C \cos(y) \\
	v = B \sin(x) + A \cos(z) \\
	w = C \sin(y) + B \cos(x)
\end{align*}

[Henon (1966) , C.R. Ad. Sci. Paris, 262, 312]
said $A = \sqrt{3},B = \sqrt{2},C=1$ is chaotic.

\subsection{High dimensional example}
SRI models?  Quadrotor dynamics?  Chemical reaction dynamics?

\section{Conclusion}

\subsection{Open questions}
Koopmanism?  Noise?  Control?  Differential structures (e.g. the exterior derivative)?  The link with non-commutative geometry.

\subsection{Acknowledgements}

\bibliographystyle{amsalpha}
\bibliography{hoj.bib}
\end{document}
